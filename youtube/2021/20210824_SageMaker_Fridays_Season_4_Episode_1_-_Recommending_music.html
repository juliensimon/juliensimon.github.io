<!DOCTYPE html>

<html lang="en">
<head>
<meta content="SageMaker Fridays Season 4 Episode 1   Recommending music - Broadcasted on 06/08/2021. Join us for more episodes at https://pages.awscloud.com/SageMakerFridays

⭐️⭐️⭐️ Don't forget to subscribe to be notified of future v..." name="description"/><meta content="SageMaker Fridays Season 4 Episode 1   Recommending music - Julien Simon" property="og:title"/><meta content="SageMaker Fridays Season 4 Episode 1   Recommending music - Broadcasted on 06/08/2021. Join us for more episodes at https://pages.awscloud.com/SageMakerFridays

⭐️⭐️⭐️ Don't forget to subscribe to be notified of future v..." property="og:description"/><meta content="https://www.julien.org/youtube/2021/20210824_SageMaker_Fridays_Season_4_Episode_1_-_Recommending_music.html" property="og:url"/><meta content="video" property="og:type"/><meta content="summary_large_image" name="twitter:card"/><meta content="SageMaker Fridays Season 4 Episode 1   Recommending music - Julien Simon" name="twitter:title"/><meta content="SageMaker Fridays Season 4 Episode 1   Recommending music - Broadcasted on 06/08/2021. Join us for more episodes at https://pages.awscloud.com/SageMakerFridays

⭐️⭐️⭐️ Don't forget to subscribe to be notified of future v..." name="twitter:description"/><link href="https://www.julien.org/youtube/2021/20210824_SageMaker_Fridays_Season_4_Episode_1_-_Recommending_music.html" rel="canonical"/><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>
<!-- Umami Analytics -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="27550dad-d418-4f5d-ad1b-dab573da1020"></script>
<link rel="dns-prefetch" href="//cloud.umami.is">SageMaker Fridays Season 4 Episode 1   Recommending music - Julien Simon</title>
<style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        .date {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 30px;
            font-weight: 500;
        }
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            margin-bottom: 30px;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
        }
        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            white-space: pre-wrap;
            font-size: 1em;
        }
        .description a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .description a:hover {
            color: #2980b9;
            text-decoration: underline;
        }
        .transcript {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            white-space: pre-wrap;
            font-size: 1em;
        }
        .transcript h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .tags {
            margin-bottom: 30px;
        }
        .tags h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .tag {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        .links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .link {
            display: inline-block;
            padding: 12px 24px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .link:hover {
            background: #2980b9;
        }
        .link.youtube {
            background: #e74c3c;
        }
        .link.youtube:hover {
            background: #c0392b;
        }
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            h1 {
                font-size: 1.8em;
            }
            .links {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
<h1>SageMaker Fridays Season 4 Episode 1   Recommending music</h1>
<div class="date">August 24, 2021</div>
<div class="video-container">
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" src="https://www.youtube.com/embed/zbKRKtEpiSw">
</iframe>
</div>
<div class="description">Broadcasted on 06/08/2021. Join us for more episodes at <a href="https://pages.awscloud.com/SageMakerFridays" rel="noopener noreferrer" target="_blank">https://pages.awscloud.com/SageMakerFridays</a>

⭐️⭐️⭐️ Don't forget to subscribe to be notified of future videos ⭐️⭐️⭐️

In this episode, we'll show you how to build a music recommendation model.

*** Notebook

<a href="https://github.com/aws/amazon-sagemaker-examples/tree/master/end_to_end/music_recommendation" rel="noopener noreferrer" target="_blank">https://github.com/aws/amazon-sagemaker-examples/tree/master/end_to_end/music_recommendation</a></div>
<div class="transcript">
<h2>Transcript</h2>
            Good morning, everyone, and welcome to this new season of Sage Makeup Fridays. It's already season four. My name is Julien, and I'm a principal developer advocate focusing on AI and machine learning. Please meet my co-presenter. Hi, everyone. My name is Seygoleyn, and I'm a senior data scientist working with AWS Machine Learning Solution Lab. My role is to help customers get their ML projects on the right track to create business value as fast as possible. Thank you for joining us. We will definitely need your expertise. If you're new to SageMaker Fridays, you'll quickly find out. This is 100% demo. We have just a few intro slides to let you know about this new season, but then we're going to be running code and diving into problems. If you have questions, please ask all your questions. We have moderators who are ready to answer everything. So just don't be shy. Ask anything you'd like to know. Make sure you learn as much as possible. Okay? So here's the agenda for this new season. It's in three parts. The first four episodes focus on the data science part of machine learning, where we prepare data, train models, explain models, etc. Then we'll have four more episodes on ops in general and automation, with a strong focus on automation. We'll probably revisit some of those early examples and add automation to them. Finally, we have four episodes where we look at AutoML, trying to automatically build models. So quite a lot of episodes ahead, and we hope you find them interesting all the way to October 22. 

What are we going to talk about today? Today, we are going to work on the music recommendation problem. We will focus on the data science and machine learning angle. We are going to cover data preparation, deployment, training, prediction, and explainability. Let's look at the pipeline. Don't worry, we'll show you the URL again if you didn't catch it the first time around. This is the end-to-end workflow we're covering. It's a great opportunity to learn about many of SageMaker's capabilities. We'll start from a dataset, use SageMaker Data Wrangler to process it and run feature engineering, ingest the engineered features into SageMaker Feature Store, and use those features to create a dataset. We'll use Amazon Athena to query the Feature Store and retrieve data. Then, we'll use that dataset to train a model with XGBoost, and use SageMaker Debugger during training to capture the model state, particularly for explainability and future reports. We'll stop here for this episode because there's so much more to cover. We'll discuss the rest, mostly automation, the model registry, model monitor, and other ops, in a September episode. For now, we'll cover data prep, feature store, training, and explainability and feature importance. 

That's about as much of the slides as you'll get today. Let's save them for later and start talking about the problem. Music recommendation with XGBoost. It's a bit of a surprise because I thought recommendation was a very hard problem that required fancy deep learning models. Here we're using XGBoost. But how did we frame the problem so that it can be learned by XGBoost? We framed it as a regression problem. Each track has features such as energy, speechiness, tempo, genre, etc. We can frame the problem as a regression problem instead of using more advanced deep learning techniques. We're trying to predict a numerical rating from one to five. So, it's a regression problem. 

Looking at the dataset, we have the tracks.csv file with features like length, energy, speechiness, instrumentalness, tempo, and genre. These are values between zero and one. Zero means no speech, one means it's spoken. Similarly, for how instrumental the track is, whether there's a live audience, the tempo, and the genre. I should mention that there's no heavy metal or hard rock, but I guess I don't need machine learning to tell me what I like. Heavy metal, nothing else. Let's not discuss my musical taste. 

We have a user ID and a track ID that matches the track ID in the other file, the session ID, the location of the song in that session, and the rating. These are individual reviews. Assuming I was in this dataset and had rated 200 tracks, how would you know what I like? You would aggregate these features and build the recommendation system on top of that. For a given user ID, you would look at all the ratings for that user, find the five-star ratings, and understand their preferences. For example, they might like very energetic and up-tempo tracks. You would compute aggregated stats on the file. The five-star reviews are a good indicator. We need to do this because it's not in the initial dataset. It's part of our data prep workflow. These become new features that we can inject. 

How big is this dataset? It's based on the Last.fm Million Song Dataset with additional processing. The dataset we're working on today has about 140,000 tracks and 258 users. We have around 700,000 ratings. It's reasonably large, with many ratings per user. We should be able to do a good job. The tracks have properties and a track ID referenced in the ratings, which have the user ID and the rating itself. 

Let's look at data prep now. We're using SageMaker Data Wrangler. You can visually import datasets and add transforms. We've applied a few simple transforms. For tracks, we insert a new column called event time with a timestamp. We also compute a new column called danceability, which I don't like, so I should rename it headbangability. We encode categorical features, like the genre. For ratings, we probably insert a timestamp as well. We set data types for the columns. We can export this workflow. For the two tables, we do limited work but then join them on the track ID. This gives us the track features for each review in the same row, which we need to compute aggregators. We apply a PySpark transform to compute averages of numerical columns and one-hot encoded genres for five-star reviews, which become user preferences. 

To run the transforms, we go to export. We can save to S3, which means running a SageMaker process. SageMaker processing is easy to work with and lets you run batch jobs for data prep, model evaluation, etc. We run a job on managed infrastructure with a few lines of code, and get the processed data in S3. Another option is to export the Python code for the feature engineering workflow, which you can put in your repository. We can also create a notebook that exports data to the Feature Store, which we'll do here. Finally, we can set up a pipeline for automation, which we'll cover later. 

We have a flow file in JSON format. We run this three times to process tracks, ratings, and build user preferences. We have three notebooks that do the same thing over different sources. For tracks, we need a schema for the feature store, which is the name of the features and their types. We create a feature group, an object that stores features from a data source. We create the feature group with a name, schema, and unique identifier (record ID) and event time. The record ID is the unique identifier for each row, and the event time is the timestamp for the engineered feature. We create the feature group, wait for it to be fully created, and then run our workflow to push data to the Feature Store. 

We use SageMaker Processing, a batch job with inputs and outputs. The inputs are the tracks.csv file in S3, and the output is the processed data in S3. The output is the data from a specific node in the workflow graph. We pick the node identifier from the JSON file to get the processed data at different stages. We run the processing job on the specified instance size and count, and it saves the data. We do this for user preferences and ratings as well. 

Now that we've processed our data, we can train our model. We build the dataset by querying the three feature groups in the offline feature store using Amazon Athena. We can query the data directly in S3 because creating a feature group automatically creates an Athena table. We have tables for ratings, tracks, and user preferences. We can preview the data and see the five-star aggregated preferences, such as user 11063 liking high-energy songs and disliking acoustic and instrumental songs, with a favorite genre of rap. 

We merge the ratings with the track and user preference data to create the final dataset. Each row has the rating, review information, user preferences, and track information. We split the dataset for training and validation, save it to CSV files, and upload them to S3. We configure our training inputs and set up the training job with infrastructure requirements, the XGBoost container, and hyperparameters. We use SageMaker Debugger to save model state during training, including metrics, feature importance, and SHAP values. We set rules to check for unwanted conditions, like loss not decreasing, which could indicate overfitting. 

We train the model with a one-liner, passing the location of the training and validation sets. The job runs on the specified infrastructure, pulls the container, loads the data, and starts training. Once complete, the infrastructure is shut down, and the model is saved in S3. We can load the data saved by SageMaker Debugger and plot metrics like mean square error. We can also plot feature importance and SHAP values to understand how features contribute to the output prediction. For example, we see that some features have a positive impact, while others have a negative impact. We can analyze SHAP values for each instance in the training set to understand the model's explainability. 

This is a good example of a data scientist's daily job, from processing data to training and explaining the model. We'll come back to downstream tasks like the model registry and automation with pipelines in future episodes. The repository for this example is available, and you can run the code yourself. Thank you for joining us. Next time, we'll cover fraud detection, including bias analysis and mitigation. Thank you, Seygoleyn, and thank you everyone for listening. See you next week for another episode. Bye-bye.
        </div>
<div class="tags">
<h2>Tags</h2>
<span class="tag">MachineLearning</span><span class="tag">SageMaker</span><span class="tag">DataPreparation</span><span class="tag">XGBoost</span><span class="tag">RecommendationSystem</span>
</div>
<div class="links"><a class="link" href="../../../youtube.html">← Back to YouTube Overview</a></div>
</div>
</body>
</html>