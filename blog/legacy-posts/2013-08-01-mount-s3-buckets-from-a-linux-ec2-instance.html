<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Legacy blog post by Julien Simon">
  <meta name="author" content="Julien Simon">
  <meta name="robots" content="index, follow">
  
  <title>Mount S3 Buckets From A Linux Ec2 Instance â€“ Julien Simon</title>
  
  <!-- Umami Analytics -->
  <script>
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.src = 'https://cloud.umami.is/script.js';
      script.setAttribute('data-website-id', '27550dad-d418-4f5d-ad1b-dab573da1020');
      document.head.appendChild(script);
    });
  </script>
  
  <!-- Resource hints for faster DNS resolution and connections -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/social-icons.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
  
  <!-- Legacy post specific styles -->
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--background);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      text-align: center;
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 2px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      line-height: 1.2;
    }
    
    .legacy-post-meta {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }
    
    .legacy-post-date {
      background: var(--surface);
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
    }
    
    .legacy-post-category {
      background: var(--primary-color);
      color: white;
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
      text-transform: uppercase;
      font-size: var(--text-xs);
      letter-spacing: 0.5px;
    }
    
    .legacy-post-content {
      line-height: 1.8;
      color: var(--text-primary);
      font-size: var(--text-base);
    }
    
    .legacy-post-content h1,
    .legacy-post-content h2,
    .legacy-post-content h3,
    .legacy-post-content h4 {
      color: var(--text-primary);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
      font-weight: 600;
    }
    
    .legacy-post-content h1 { font-size: var(--text-2xl); }
    .legacy-post-content h2 { font-size: var(--text-xl); }
    .legacy-post-content h3 { font-size: var(--text-lg); }
    .legacy-post-content h4 { font-size: var(--text-base); }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin-bottom: var(--space-4);
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content code {
      background: var(--surface);
      color: var(--primary-color);
      padding: var(--space-1) var(--space-2);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: var(--space-4);
      overflow-x: auto;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-6) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .legacy-post-content a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .separator {
      clear: both;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
      background: var(--primary-color);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: var(--text-sm);
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">Mount S3 Buckets From A Linux Ec2 Instance</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">August 1, 2013</span>
            <span class="legacy-post-category">Cloud & AWS</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          As we all know, the preferred way to access AWS S3 is to use the&nbsp;<a href="http://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html">S3 API</a>. However, you should know that it's also possible to mount an S3 bucket and access it like a normal filesystem.<br />
<br />
As always with Open Source, you have a number of different options: the one I'll show you today is a user-land filesystem (aka FUSE) called&nbsp;<i><a href="https://code.google.com/p/s3fs/">s3fs</a>. </i>The project is quite active and provides actual support to its users :)<br />
<br />
This how-to assumes that you already have an AWS account with EC2 instances and S3 buckets. If not, go to the AWS website and <a href="http://docs.aws.amazon.com/gettingstarted/latest/awsgsg-intro/intro.html">get started</a>&nbsp;:)<br />
<br />
As usual, I'll be using a vanilla Ubuntu 12.04 instance, let's '<i>ssh</i>' into it and install what we need.<br />
<br />
First, let's grab the <i>s3fs</i> sources (at the time of writing, the latest version is 1.71):<br />
<br />
<span>$ <b>wget</b> http://s3fs.googlecode.com/files/s3fs-1.71.tar.gz</span><br />
<span>
Then, let's add all the development packages required to build it. I'm starting from a fresh instance, so this is really needed. If your VM is already populated with all these packages, you can skip this step.<br />
<div>
<span>$ sudo <b>apt-get</b> <b>update<br />
<div>
<span>$ sudo <b>apt-get</b> <b>install</b> make gcc g++ pkg-config libfuse-dev libcurl4-openssl-dev libxml2-dev
<div>
<span>
Now, let's build <i>s3fs</i>:<br />
<span></div>
<div>
<span>$ <b>tar xvfz</b> s3fs-1.71.tar.gz
<div>
<span>$ <b>cd</b>&nbsp;s3fs-1.71
<div>
<span>$ <b>./configure<br />
<span>$<b> make</div>
<div>
<span>$ sudo <b>make install</div>
<div>
<span>
The next step creates a file storing the AWS keys (insert your own!) required by S3 to allow your <i>s3fs</i> requests:</div>
<div>
<div>
<div>
<div>
<span>$ <b>echo</b> ACCESS_KEY_ID:SECRET_ACCESS_KEY/ &gt; ~/.passwd-s3fs
<div>
<span>$ <b>chmod</b> 400 ~/.passwd-s3fs
</div>
<div>
<span>
The last step is to create a mount point with the right ownership, as well as a cache directory:<br />
<span></div>
</div>
<div>
<span>$ sudo <b>mkdir</b> /mnt/s3
<div>
<div>
<span>$ sudo <b>chown</b> ubuntu:ubuntu /mnt/s3
</div>
<div>
<span>$ <b>mkdir</b> ~/cache
<div>
<span>
We are now ready to mount our bucket (again, use your own bucket name):</div>
<div>
<span></div>
<div>
<span>$ <b>id</div>
<div>
<span>uid=1000(ubuntu) gid=1000(ubuntu)&nbsp;
<div>
<div>
<span>$ <b>s3fs</b> -o uid=1000,gid=1000,use_cache=/home/ubuntu/cache myBucket /mnt/s3
</div>
<div>
<span>$ </span><b>mount
<div>
<div>
<span><i>output removed for brevity</div>
<div>
s3fs on /mnt/s3 type fuse.s3fs (rw,nosuid,nodev,user=ubuntu)
<div>
<br />
This worked. Let's copy a file and see what kind of performance we can get:<br />
<div>
<div>
<div>
<div>
<span>$ <b>time</b> <b>cp</b> /mnt/s3/6MegabyteFile .
<div>
<span>real0m0.572s
<div>
<span>user0m0.000s
<div>
<span>sys0m0.012s
</div>
<div>
<span>
<span>About 10 Megabytes per second :-/ S3 is not famous for its speed and this is another proof. In this example, the EC2 instance and the S3 buckets are located in the same zone (eu-west). I'm not sure I want to find out what happens when they're not!</span><br />
<span><br />
All the more reason to check that the cache works, then:</span><br />
<span>
<span>$ <b>ls</b>&nbsp;-l /home/ubuntu/cache/myBucket
<div>
<span>-rw-r--r-- 1 ubuntu ubuntu 6196315 Jul 31 17:39&nbsp;</span><span>6MegabyteFile
<div>
<div>
<span>$ <b>time cp</b> -f /mnt/s3/</span><span>6MegabyteFile</span><span>&nbsp;.
<div>
<span>real0m0.027s
<div>
<span>user0m0.000s
<div>
<span>sys0m0.020s</span><br />
<span>
<span>Yes, it does. Let's give it another shot:</span><br />
<span>
<div>
<span>$ <b>rm</b>&nbsp;</span><span>/home/ubuntu/cache/myBucket/</span><span>6MegabyteFile
<div>
<span>$&nbsp;<b>time cp</b>&nbsp;-f /mnt/s3/</span><span>6MegabyteFile</span><span>&nbsp;.</span><br />
<span>real</span><span>0m0.787s
<div>
<div>
user0m0.000s</div>
<div>
<div>
sys0m0.012s</div>
<div>
<span>Argh, even slower! &nbsp;Now, let's&nbsp;</span><span>unmount the bucket like any other filesystem:</span><br />
<span></div>
<div>
$ sudo <b>umount</b> /mnt/s3/
<div>
<div>
B<span>eing able to access your buckets locally is a great feature for testing, debugging and maybe some simple production use cases. I've always been a sucker for filesystems ("Everything Is A File", remember?) and this one is definitely cool. Try it out!
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>