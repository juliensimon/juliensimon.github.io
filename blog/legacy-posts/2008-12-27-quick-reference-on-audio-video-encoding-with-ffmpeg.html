<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick Reference on Audio/Video Encoding with FFmpeg - Julien Simon</title>
  <meta name="description" content="A comprehensive quick reference guide for audio and video encoding using FFmpeg, including MP3, AAC, H.264, and mobile formats.">
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="icon" href="../../assets/favicon.ico" type="image/x-icon">
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-3);
    }
    
    .legacy-post-meta {
      display: flex;
      gap: var(--space-4);
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content {
      line-height: 1.7;
      color: var(--text-primary);
    }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content h2 {
      font-size: var(--text-xl);
      font-weight: 600;
      color: var(--text-primary);
      margin: var(--space-6) 0 var(--space-4) 0;
      padding-top: var(--space-4);
      border-top: 1px solid var(--border);
    }
    
    .legacy-post-content h3 {
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: var(--space-5) 0 var(--space-3) 0;
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin: var(--space-4) 0;
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content pre {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--space-4);
      margin: var(--space-4) 0;
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content code {
      background: var(--code-bg);
      padding: 2px 4px;
      border-radius: var(--radius-sm);
      font-family: var(--font-mono);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-4) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .legacy-post-content a:hover {
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius);
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">Quick Reference on Audio/Video Encoding with FFmpeg</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">December 27, 2008</span>
            <span class="legacy-post-category">Multimedia</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <p>The purpose of this article is to serve as a quick reference on how to use FFmpeg for audio and video encoding. Boy can these FFmpeg flags be tricky to remember, especially codec names: they can really drive me crazy :)</p>

          <p>Let's cover audio encoding first (MPEG, MP3, AAC, 3GPP AMR, OGG, FLAC & WMA). Then, we'll talk about video (MPEG, FLV, XVID, MP4, Theora, WMV, H.264 & MKV), with a tiny bit of benchmarking as well. Finally, we'll try some heavy duty video compression for mobile devices.</p>

          <p>BTW, all these examples work (!) with the <a href="2008-20-12-compiling-ffmeg-x264-mp3-xvid-amr-on-ubuntu.html">latest FFmpeg</a> and all output files have been successfully tested with <a href="2008-12-21-compiling-vlc-live555-all-major-codecs-on-ubuntu.html">VLC 0.9.8a</a>.</p>

          <h2>1) Audio encoding</h2>

          <p>The <code>audio.wav</code> sample file is PCM audio (pcm_sb16le) inside a WAV container.</p>

          <p>Some generic audio options:</p>
          <ul>
            <li><code>-f</code>: the output file format (i.e container)</li>
            <li><code>-acodec</code>: the codec to use for encoding</li>
            <li><code>-ab</code>: the bitrate in bits per second (e.g. 64000, 64k, etc)</li>
            <li><code>-ar</code>: the sampling rate in Hertz (e.g. 22000, 44100, etc)</li>
            <li><code>-ac</code>: the number of channels (e.g. 1 for mono, 2 for stereo, etc)</li>
          </ul>

          <h3>MPEG-1 layer 2 audio</h3>
          <pre><code>% ffmpeg -i audio.wav -acodec mp2 -ab 192k audio.mp2</code></pre>

          <h3>MPEG-1 layer 3 audio, Constant Bit Rate (CBR)</h3>
          <pre><code>% ffmpeg -i audio.wav -acodec libmp3lame -ab 192k audio.mp3</code></pre>

          <h3>MPEG-1 layer 3 (MP3) audio, Variable Bit Rate (VBR)</h3>
          <pre><code>% ffmpeg -i audio.wav -acodec libmp3lame -aq [0-255] audio.mp3</code></pre>
          <p>0: highest quality (weird, I know).</p>

          <h3>AAC audio, Constant Bit Rate (CBR)</h3>
          <pre><code>% ffmpeg -i audio.wav -f adts -acodec libfaac -ab 192k audio.aac</code></pre>

          <h3>AAC audio, Variable Bit Rate (VBR)</h3>
          <pre><code>% ffmpeg -i audio.wav -f adts -acodec libfaac -aq [0-255] audio.aac</code></pre>
          <p>0: lowest quality, 255: highest quality</p>

          <h3>3GPP AMR Narrow band (AMR-NB), 8KHz, 6.7Kbit/s</h3>
          <pre><code>% ffmpeg -i audio.wav -f 3gp -acodec libamr_nb -ac 1 -ar 8000 -ab 6.7k audio.3gp</code></pre>

          <h3>3GPP AMR Wideband (AMR-WB), 16KHz, 23.85Kbit/s</h3>
          <pre><code>% ffmpeg -i audio.wav -f 3gp -acodec libamr_wb -ac 1 -ar 16000 -ab 23.85k audio.3gp</code></pre>

          <h3>OGG Vorbis, Constant Bit Rate (CBR)</h3>
          <pre><code>% ffmpeg -i audio.wav -f ogg -acodec libvorbis -ab 192k audio.ogg</code></pre>

          <h3>OGG Vorbis, Variable Bit Rate (VBR)</h3>
          <pre><code>% ffmpeg -i audio.wav -f ogg -acodec libvorbis -aq [0-255] -ab 192k audio.ogg</code></pre>
          <p>0: lowest quality, 255: highest quality</p>

          <h3>FLAC</h3>
          <pre><code>% ffmpeg -i audio.wav -acodec flac audio.flac</code></pre>

          <h3>Windows Audio Media v2</h3>
          <pre><code>% ffmpeg -i audio.wav -acodec wmav2 -ab 256k audio.wma</code></pre>

          <h2>2) Video encoding</h2>

          <p>The <code>video.mpg</code> sample file is a 3-minute video clip: 352x288 resolution, MPEG-2 PS container, MPEG-1 video (1700 Kbit/s), MPEG-1 layer 2 audio (224 Kbit/s) → 41.7 MB.</p>

          <p>Here, just for reference, I will also look at the encoding time and at the size of the output file. FYI, I'm running these tests on a 1.83GHz Intel Core 2 CPU.</p>

          <p>Some generic video options:</p>
          <ul>
            <li><code>-f</code>: the output file format (i.e container)</li>
            <li><code>-vcodec</code>: the codec to use for encoding</li>
            <li><code>-b</code>: the bitrate in bits per second (e.g. 1024k)</li>
            <li><code>-r</code>: the rate in frames per second (e.g. 25)</li>
            <li><code>-async 1</code>: synchronize the start of the audio and video streams</li>
          </ul>

          <h3>MPEG-2 PS container, MPEG-2 video, audio untouched</h3>
          <pre><code>% ffmpeg -i video.mpg -f mpeg -vcodec mpeg2video -acodec copy video2.mpg</code></pre>
          <p><code>copy</code> can be used to leave the audio / video source stream as is.</p>

          <h3>FLV container, H263 video, MPEG-1 layer 3 (MP3) audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f flv -vcodec flv -r 25 -b 1024k -acodec libmp3lame -ab 128k -ac 2 video.flv</code></pre>
          <p>→ 20 seconds, 6.4 MB</p>

          <h3>AVI container, XVID video, MPEG-1 layer 3 (MP3) audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f avi -vcodec libxvid -r 25 -b 1024k -acodec libmp3lame -ab 128k -ac 2 video.avi</code></pre>
          <p>→ 29 seconds, 24.7 MB.</p>

          <h3>MPEG4 container, MPEG-4 video (Simple profile, L1), AAC-LC audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f mp4 -vcodec mpeg4 -r 25 -b 1024k -acodec libfaac -ab 128k -ac 2 -async 1 video.mp4</code></pre>
          <p>→ 22 seconds, 24.6 MB</p>

          <h3>OGG container, Theora video, Vorbis audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f ogg -vcodec libtheora -r 25 -b 1024k -acodec libvorbis -ab 128k -ac 2 -async 1 video.ogg</code></pre>
          <p>→ 1 minute 24 seconds, 24.4 MB</p>

          <h3>AVI container, Windows Media Video 8 (WMV9), Windows Media Audio 2 (WMA2)</h3>
          <pre><code>% ffmpeg -i video.mpg -f avi -vcodec wmv2 -r 25 -b 1024k -acodec wmav2 -ab 128k -ac 2 -async 1 video.avi</code></pre>
          <p>→ 18 seconds, 24.7 MB</p>

          <h3>MP4 container, H.264/AVC (Baseline profile, L2.1) video, AAC-LC audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f mp4 -vcodec libx264 -r 25 -b 1024k -acodec libfaac -ab 128k -ac 2 -async 1 video.mp4</code></pre>
          <p>→ 1 minute 19 seconds, 25.5 MB</p>

          <h3>Matroska container (MKV), H.264/AVC (Baseline profile, L2.1) video, AAC-LC audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f matroska -vcodec libx264 -r 25 -b 1024k -acodec libfaac -ab 128k -ac 2 -async 1 video.mkv</code></pre>
          <p>→ same as above: only the container differs</p>

          <p>Or you could have reused the MP4 file above to perform a simple re-muxing of the audio and video streams into a MKV container:</p>

          <pre><code>% ffmpeg -i video.mp4 -f matroska -vcodec copy -acodec copy video.mkv</code></pre>

          <h2>3) Mobile video encoding</h2>

          <p>Now, let's try some heavy duty compression!</p>

          <h3>3GPP container, H.263 video, AMR-WB audio</h3>
          <pre><code>% ffmpeg -i video.mpg -f 3gp -vcodec h263 -b 256k -r 15 -acodec libamr_wb -ac 1 -ar 16000 -ab 23.85k -async 1 video.3gp</code></pre>
          <p>→ 15 seconds, 6.1 MB</p>

          <p>Let's resize the video to <code>qcif</code> (176x144) and degrade the video stream. Since this is a music video, I can't really degrade the audio stream any further.</p>

          <pre><code>% ffmpeg -i video.mpg -f 3gp -s qcif -vcodec h263 -b 96k -r 12 -acodec libamr_wb -ac 1 -ar 16000 -ab 23.85k -async 1 video.3gp</code></pre>
          <p>→ 13.2 seconds, 2.7 MB</p>

          <p>Let's degrade video even more.</p>

          <pre><code>% ffmpeg -i video.mpg -f 3gp -s qcif -vcodec h263 -b 48k -r 10 -acodec libamr_wb -ac 1 -ar 16000 -ab 23.85k -async 1 video.3gp</code></pre>
          <p>→ 12.5 seconds, 1.7 MB... and still enjoyable at less than 100 Kbit/s. That's 20x less than the original video.</p>

          <p>OK, enough for now. I'll probably keep adding to this page to help my failing memory :) There's also plenty more to explore, especially on the x264 side, but that's it for today!</p>
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>