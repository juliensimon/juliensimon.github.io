<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Legacy blog post by Julien Simon">
  <meta name="author" content="Julien Simon">
  <meta name="robots" content="index, follow">
  
  <title>The Billion Dollar App Part5 1 – Julien Simon</title>
  
  <!-- Umami Analytics -->
  <script>
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.src = 'https://cloud.umami.is/script.js';
      script.setAttribute('data-website-id', '27550dad-d418-4f5d-ad1b-dab573da1020');
      document.head.appendChild(script);
    });
  </script>
  
  <!-- Resource hints for faster DNS resolution and connections -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/social-icons.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
  
  <!-- Legacy post specific styles -->
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--background);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      text-align: center;
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 2px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      line-height: 1.2;
    }
    
    .legacy-post-meta {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }
    
    .legacy-post-date {
      background: var(--surface);
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
    }
    
    .legacy-post-category {
      background: var(--primary-color);
      color: white;
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
      text-transform: uppercase;
      font-size: var(--text-xs);
      letter-spacing: 0.5px;
    }
    
    .legacy-post-content {
      line-height: 1.8;
      color: var(--text-primary);
      font-size: var(--text-base);
    }
    
    .legacy-post-content h1,
    .legacy-post-content h2,
    .legacy-post-content h3,
    .legacy-post-content h4 {
      color: var(--text-primary);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
      font-weight: 600;
    }
    
    .legacy-post-content h1 { font-size: var(--text-2xl); }
    .legacy-post-content h2 { font-size: var(--text-xl); }
    .legacy-post-content h3 { font-size: var(--text-lg); }
    .legacy-post-content h4 { font-size: var(--text-base); }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin-bottom: var(--space-4);
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content code {
      background: var(--surface);
      color: var(--primary-color);
      padding: var(--space-1) var(--space-2);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: var(--space-4);
      overflow-x: auto;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-6) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .legacy-post-content a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .separator {
      clear: both;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
      background: var(--primary-color);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: var(--text-sm);
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      <p class="subtitle">World Expert in Practical AI</p>
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">The Billion Dollar App Part5 1</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">August 17, 2013</span>
            <span class="legacy-post-category">Linux & Ubuntu</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <a href="https://en.wikipedia.org/wiki/Leslie_Lamport">Leslie Lamport</a> once said (before many of you were even born): "<i>You know you have a distributed system when the crash of a computer you've never heard of stops you from getting any work done</i>". The Internet sure proved him right, as demonstrated again last night by Google and their global worldwide crash...<br />
<br />
However, when distributed systems work as intended, interesting things do happen. For instance, if one was so inclined, one could reimplement a server in a different language while preserving interfaces and things-would-still-work.<br />
<br />
And so, as I sipped my morning coffee, I became very much fucking inclined indeed to rewrite <a href="http://juliensimon.blogspot.fr/2013/08/nodejs-part-5-zero-hero.html">yesterday's Node.js <i>zeromq</i> server</a>&nbsp;in C. Call it my stupid idea of the day... or just an interesting comparison of two pieces of code standing 40 years apart :) In the real world, one good reason to do this would be to improve performance of critical parts of your application: divide, rewrite, conquer!<br />
<br />
Here's the ANSI89-compliant code (also on <a href="https://github.com/juliensimon/NodeApp/blob/master/v5-server.c">Github</a>), the only deviance being the use of <i>snprintf</i>() which only made it into C99 :)<br />
<br />
<textarea cols="80" rows="41">#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <zmq.h>
#define BUFFER_LEN      255
#define PORT            "tcp://*:3000"
extern int errno;
int main(void)
{
    char buffer[BUFFER_LEN];
    int i;
    /* Create a 'reply' socket and bind it */
    void *context = zmq_ctx_new();
    void *sock = zmq_socket(context, ZMQ_REP);
    if (zmq_bind(sock, PORT) != 0) {
        printf("Cannot bind socket (err=%d), exiting", errno);
        exit(errno);
    }
    printf("Worker ready on %s\n", PORT);
    while (1) {
        i = zmq_recv (sock, buffer, BUFFER_LEN, 0);
        /* zeromq "strings" are not null-terminated */
        buffer[i] = 0;
        printf("received some stuff %s, size= %d\n", buffer, strlen(buffer));
        /* Convert to int */
        i = strtol(buffer, (char**)NULL, 10);
        /* Apply the get-rich-quick, C-optimized formula and convert to string */
        snprintf(buffer, BUFFER_LEN, "%d", i*2);
        printf("sent result %s\n", buffer);
        /* Send result */
        zmq_send (sock, buffer, strlen(buffer),0);
    }
    return 0;
}
</textarea><br />
<br />
Easy to build (no Makefile, no Maven and its XML crap):<br />
<span>ubuntu@ip-10-35-165-93:~$</span><span>&nbsp;<b>gcc</b> -ansi -pedantic -Wextra -Wall -o worker worker.c -lzmq</span><br />
<span>worker.c: In function ‘main’:</span><br />
<span>worker.c:29:2: warning: format ‘%d’ expects argument of type ‘int’, but argument 3 has type ‘size_t’ [-Wformat]</span><br />
<span>worker.c:34:2: warning: implicit declaration of function ‘snprintf’ [-Wimplicit-function-declaration]</span><br />
<span>
Let's start this C worker and hit it with some requests coming from our Node.js app:<br />
<span>ubuntu@ip-10-35-165-93:~$ ./<b>worker</b>&nbsp;</span><br />
<span>Worker ready on tcp://*:3000</span><br />
<span>received some stuff 15, size=2</span><br />
<span>sent result 30</span><br />
<span>received some stuff 8, size=1</span><br />
<span>sent result 16</span><br />
<span>
Nice. In all fairness, <a href="http://juliensimon.blogspot.fr/2013/08/nodejs-part-5-zero-hero.html">yesterday's Node.js code</a> is quite easier to read. I did add more error management clutter in the C program, but doing without it is not an option. Love them or hate them, modern languages will spit a stack trace out when they crash: most of the time, this is enough to start investigating. On the other hand, &nbsp;C will say : "<i>core dumped</i>" and leave you crying all the way home: so yes, you HAVE to write more C code to get roughly the same level of information. You can also see the immense power of&nbsp;<i>toString</i>() and dynamic typing, although the latter does introduces huge caveats.<br />
<br />
So, what did we learn? Breaking down your app not only allows you to scale it piece by piece: it also gives you the freedom to rewrite critical parts, whatever your motivation is. To me, this is true modularity, something that I've rarely seen in so-called modular architectures based on Java or C#. Having classes is nice, but <u>services</u> are what you really need.<br />
<br />
And yeah, for ultimate control and performance, C cannot be defeated. I'm quite scared to see it disappear from many curriculums. Kids, listen to the old man: you must learn C. You'll thank me later.<br />
<br />
End of sermon. Now go in peace and hack at the world!
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>