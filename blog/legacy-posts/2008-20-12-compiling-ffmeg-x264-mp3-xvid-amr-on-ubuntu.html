<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compiling FFmpeg x264 MP3 XviD AMR On Ubuntu - Julien Simon</title>
  <meta name="description" content="How to compile FFmpeg with x264, MP3, XviD, and AMR codecs on Ubuntu, including all required libraries and dependencies.">
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="icon" href="../../assets/favicon.ico" type="image/x-icon">
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-3);
    }
    
    .legacy-post-meta {
      display: flex;
      gap: var(--space-4);
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content {
      line-height: 1.7;
      color: var(--text-primary);
    }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content h2 {
      font-size: var(--text-xl);
      font-weight: 600;
      color: var(--text-primary);
      margin: var(--space-6) 0 var(--space-4) 0;
      padding-top: var(--space-4);
      border-top: 1px solid var(--border);
    }
    
    .legacy-post-content h3 {
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: var(--space-5) 0 var(--space-3) 0;
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin: var(--space-4) 0;
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content pre {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--space-4);
      margin: var(--space-4) 0;
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content code {
      background: var(--code-bg);
      padding: 2px 4px;
      border-radius: var(--radius-sm);
      font-family: var(--font-mono);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-4) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .legacy-post-content a:hover {
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius);
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      <p class="subtitle">World Expert in Practical AI</p>
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">Compiling FFmpeg x264 MP3 XviD AMR On Ubuntu</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">December 20, 2008</span>
            <span class="legacy-post-category">Linux & Ubuntu</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <p><em><strong>21/08/2013 - By popular demand (according to page view stats), I've decided to refresh this post for Ubuntu 12.04: <a href="http://juliensimon.blogspot.fr/2013/08/howto-compiling-ffmpeg-x264-mp3-aac.html">here is the updated HOWTO</a>. Enjoy :)</strong></em></p>

          <p>FFmpeg is THE audio/video conversion tool. Unfortunately, the default build included in Ubuntu is usually quite outdated, as well as lacking support for many codecs.</p>

          <p>The purpose of this article is to show you how you can build a fresh, up to date version of FFmpeg supporting (almost) all codecs. This procedure was successfully performed on Ubuntu 8.04 and 8.10.</p>

          <h2>0) Prerequisites</h2>

          <p>Before we start, let's check if subversion and git are installed. We'll need both to install some of the libraries required by FFmpeg:</p>

          <pre><code>ubuntu% svn
Type 'svn help' for usage.
ubuntu% git
usage: git [--version] [--exec-path[=GIT_EXEC_PATH]] [-p|--paginate|--no-pager] [--bare] [--git-dir=GIT_DIR] [--work-tree=GIT_WORK_TREE] [--help] COMMAND [ARGS]</code></pre>

          <p>OK, they're both present. If not, you need to install them with the following commands:</p>

          <pre><code>ubuntu% sudo apt-get install subversion
ubuntu% sudo apt-get install git git-core</code></pre>

          <p>Now would be a good time to decide where you're going to build all those sources. Just create a temporary directory anywhere you like (you'll need less than 150MB).</p>

          <p><strong>[Updated on 2008/01/02]</strong> If you have an existing installation of FFmpeg, you may run into linking issues caused by conflicting library versions. My advice is to remove all existing copies of libav* (libavcodec and so on) which may be present in /usr/lib, either by uninstalling them with APT or by deleting the .a and .so files. Please read the comments below for additional information.</p>

          <h2>1) Fetching the FFmpeg sources</h2>

          <p>First of all, let's get the latest FFmpeg source snapshot from the Subversion server:</p>

          <pre><code>ubuntu% svn checkout svn://svn.ffmpeg.org/ffmpeg/trunk ffmpeg
lots of output removed
Checked out external at revision 28172.
Checked out revision 16245.</code></pre>

          <p>Of course, you could just go ahead with configure, make, make install and be done with it. Unfortunately (?), it's not that simple. Go ahead, run configure:</p>

          <pre><code>ubuntu% cd ffmpeg
ubuntu% ./configure --prefix=/usr/local
lots of output removed
Creating config.mak and config.h...</code></pre>

          <p>Take a closer look at the output, especially at the 'Enabled encoders' section. A number of major formats, like AAC, MP3, x.264 or XViD are missing. Can you live without these? Probably not...</p>

          <p>Why, oh why are they missing? Take another look at the output of the configure command:</p>

          <pre><code>libfaac enabled           no
libmp3lame enabled        no
libx264 enabled           no
libxvid enabled           no</code></pre>

          <p>These encoders are missing because they're handled by external libraries which are not part of the FFmpeg source package. Chasing them all is a bit of a pain in the #$$ and hopefully this article will help!</p>

          <h2>2) Configuring FFmpeg... and failing</h2>

          <p>Let's go wild and enable almost everything, including shared libraries (nice if you're running multiple copies of FFmpeg) and POSIX threads (additional parallelism can't hurt):</p>

          <pre><code>ubuntu% ./configure --prefix=/usr/local --enable-gpl --enable-nonfree --enable-shared --enable-postproc --enable-avfilter --enable-avfilter-lavf --enable-pthreads --enable-x11grab --enable-bzlib --enable-libamr-nb --enable-libamr-wb --enable-libdc1394 --enable-libfaac --enable-libfaad --enable-libfaadbin --enable-libgsm --enable-libmp3lame --enable-libnut --enable-libschroedinger --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid --enable-zlib</code></pre>

          <p>It will inevitably lead to something like this:</p>

          <pre><code>FAAD test failed.
If you think configure made a mistake, make sure you are using the latest
version from SVN.  If the latest version fails, report the problem to the
ffmpeg-user@mplayerhq.hu mailing list or IRC #ffmpeg on irc.freenode.net.
Include the log file "config.err" produced by configure as this will help
solving the problem.</code></pre>

          <p>It's normal, we haven't installed the external libraries required for our FFmpeg build. Let's get to it!</p>

          <h2>3) Installing libamr</h2>

          <p>This library is needed for 3GPP speech codecs. For legal reasons, it is not part of the standard Ubuntu repository. You can find it in the <a href="http://medibuntu.org/">Medibuntu</a> repository. Of course, you need to let APT know about this new repository. These are the commands for Ubuntu 8.04 (more information on other versions <a href="https://help.ubuntu.com/community/Medibuntu">here</a>):</p>

          <pre><code>ubuntu% sudo wget http://www.medibuntu.org/sources.list.d/hardy.list --output-document=/etc/apt/sources.list.d/medibuntu.list
ubuntu% sudo apt-get update && sudo apt-get install medibuntu-keyring && sudo apt-get update</code></pre>

          <p>Now you can install libamr:</p>

          <pre><code>ubuntu% sudo apt-get install libamrnb-dev libamrwb-dev</code></pre>

          <h2>4) Installing libnut</h2>

          <p><a href="http://wiki.multimedia.cx/index.php?title=NUT">NUT</a> is a container format under construction by <a href="http://wiki.multimedia.cx/index.php?title=MPlayer">MPlayer</a> and <a href="http://wiki.multimedia.cx/index.php?title=FFmpeg">FFmpeg</a> developers. Libnut needs to be built from source:</p>

          <pre><code>ubuntu% svn co svn://svn.mplayerhq.hu/nut/src/trunk/ nut
ubuntu% cd nut
ubuntu% make
ubuntu% sudo make install</code></pre>

          <h2>5) Installing libx264</h2>

          <p><a href="http://www.videolan.org/developers/x264.html">x264</a> is a free library for encoding H264/AVC video streams.</p>

          <p>It can be fetched with APT using 'apt-get install libx264-dev' but let's make sure we have both the latest FFmpeg and the latest x264.</p>

          <p>Before we build the x264 source, we need to install:</p>
          <ul>
            <li><strong>libgpac</strong>, required to support the mp4 container with the x264 codec,</li>
            <li>the <strong>yasm</strong> assembler, required to compile several assembly language routines present in the x264 code.</li>
          </ul>

          <p>Installing libgpac is straightforward:</p>

          <pre><code>ubuntu% sudo apt-get install libgpac-dev</code></pre>

          <p>Now, let's take a look at yasm:</p>

          <pre><code>ubuntu% yasm --version
zsh: command not found: yasm</code></pre>

          <p>It's not there. Let's get it using APT:</p>

          <pre><code>ubuntu% sudo apt-get install yasm
ubuntu% yasm --version
yasm 0.5.0.1591</code></pre>

          <p>OK, now let fetch the x264 source and configure the build:</p>

          <pre><code>ubuntu% git clone git://git.videolan.org/x264.git
ubuntu% cd x264
ubuntu% ./configure --prefix=/usr/local --enable-shared
Found yasm 0.5.0.1591
Minimum version is yasm-0.6.1
If you really want to compile without asm, configure with --disable-asm.</code></pre>

          <p>Hmmm.. Do we want to use generic C routines instead of optimized assembly? No. Let's build the latest <a href="http://www.tortall.net/projects/yasm/">yasm (0.7.2 at the time of this writing):</a></p>

          <pre><code>ubuntu% sudo apt-get remove yasm
ubuntu% wget http://www.tortall.net/projects/yasm/releases/yasm-0.7.2.tar.gz
ubuntu% tar xvfz yasm-0.7.2.tar.gz
ubuntu% cd yasm-0.7.2
ubuntu% ./configure --prefix=/usr/local
ubuntu% make
ubuntu% sudo make install
ubuntu% yasm --version
yasm 0.7.2.2153</code></pre>

          <p>OK, now we can build x264:</p>

          <pre><code>ubuntu% cd x264
ubuntu% ./configure --prefix=/usr/local --enable-shared
output removed
Platform: X86
System: LINUX
asm: yes
avis input: no
mp4 output: yes
pthread: yes
debug: no
gprof: no
PIC: no
shared: yes
visualize: no
ubuntu% make
ubuntu% sudo make install</code></pre>

          <h2>6) Installing libxvid</h2>

          <p>Before we install <a href="http://www.xvid.org/">libxvid</a>, we need to check that the nasm assembler is OK. It's required to build assembly code in libxvid and you do NOT want this code to be replaced with generic C code in case nasm is missing: I ran some Xvid encoding tests with and without assembly code and there's a 2.5x factor... So read on :)</p>

          <p>You need at least nasm 2.0, so let's check the default version on Ubuntu 8.04 and Ubuntu 8.10:</p>

          <pre><code>ubuntu8.04% sudo apt-get install nasm
ubuntu8.04% nasm -v
NASM version 0.99.06-20071101 compiled on Sep 16 2008

ubuntu8.10% sudo apt-get install nasm
ubuntu8.10% nasm -v
NASM version 2.03.01 compiled on Jun 19 2008</code></pre>

          <p>So, if you have 8.10, you're good to go and you can skip the rest of this section. If you have 8.04, follow me:</p>

          <pre><code>ubuntu% sudo apt-get remove nasm
ubuntu% wget http://www.nasm.us/pub/nasm/releasebuilds/2.05.01/nasm-2.05.01.tar.gz
ubuntu% tar xvfz nasm-2.05.01.tar.gz
ubuntu% cd nasm-2.05.01
ubuntu% ./configure --prefix=/usr/local
ubuntu% make
ubuntu% sudo make install
ubuntu% nasm -v
NASM version 2.05.01 compiled on Dec 23 2008</code></pre>

          <p>Now, let's fetch the xvid sources and build them:</p>

          <pre><code>ubuntu% wget http://downloads.xvid.org/downloads/xvidcore-1.2.1.tar.gz
ubuntu% tar xvfz xvidcore-1.2.1.tar.gz
ubuntu% cd xvidcore/build/generic
ubuntu% ./configure --prefix=/usr/local
ubuntu% make
lots of output removed
---------------------------------------------------------------
Xvid has been successfully built.

* Binaries are currently located in the '=build' directory
* To install them on your system, you can run '# make install'
as root.
---------------------------------------------------------------</code></pre>

          <p>Let's install it:</p>

          <pre><code>ubuntu% sudo make install</code></pre>

          <h2>7) Installing the remaining libraries</h2>

          <p>Now let's install all the remaining libraries that FFmpeg needs:</p>

          <pre><code>ubuntu% sudo apt-get install libfaac-dev libfaad-dev libmp3lame-dev libschroedinger-dev libtheora-dev libvorbis-dev libgsm1-dev</code></pre>

          <h2>8) Building FFmpeg</h2>

          <p>Now we can go back to our FFmpeg directory and try the configure command again:</p>

          <pre><code>ubuntu% cd ffmpeg
ubuntu% ./configure --prefix=/usr/local --enable-gpl --enable-nonfree --enable-shared --enable-postproc --enable-avfilter --enable-avfilter-lavf --enable-pthreads --enable-x11grab --enable-bzlib --enable-libamr-nb --enable-libamr-wb --enable-libdc1394 --enable-libfaac --enable-libfaad --enable-libfaadbin --enable-libgsm --enable-libmp3lame --enable-libnut --enable-libschroedinger --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid --enable-zlib</code></pre>

          <p>This should now work without errors. Let's build FFmpeg:</p>

          <pre><code>ubuntu% make
lots of output removed
ubuntu% sudo make install</code></pre>

          <h2>9) Testing our build</h2>

          <p>Let's check that our FFmpeg build includes all the codecs we wanted:</p>

          <pre><code>ubuntu% ffmpeg -codecs | grep -E "(264|mp3|xvid|amr)"
ffmpeg version SVN-r16245, Copyright (c) 2000-2008 Fabrice Bellard, et al.
  configuration: --prefix=/usr/local --enable-gpl --enable-nonfree --enable-shared --enable-postproc --enable-avfilter --enable-avfilter-lavf --enable-pthreads --enable-x11grab --enable-bzlib --enable-libamr-nb --enable-libamr-wb --enable-libdc1394 --enable-libfaac --enable-libfaad --enable-libfaadbin --enable-libgsm --enable-libmp3lame --enable-libnut --enable-libschroedinger --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid --enable-zlib
  libavutil version: 49.12.0
  libavcodec version: 51.76.0
  libavformat version: 52.13.0
  libavdevice version: 52.0.0
  libavfilter version: 0.0.1
  libswscale version: 0.6.1
  built on Dec 20 2008 22:30:00, gcc: 4.2.4
 D A D 264                  H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10
 D A D amr_nb              AMR narrow band
 D A D amr_wb              AMR wide band
 D A D mp3                 MPEG audio layer 1/2/3
 D A D mpeg4               MPEG-4 part 2
 D A D xvid                Xvid</code></pre>

          <p>Perfect! All our codecs are there. Let's run a quick test to make sure everything works:</p>

          <pre><code>ubuntu% ffmpeg -i input.avi -vcodec libx264 -acodec libmp3lame output.mp4</code></pre>

          <p>We're done! Now you have a fully-featured FFmpeg build with support for all major codecs including H.264, MP3, XviD, and AMR.</p>
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>