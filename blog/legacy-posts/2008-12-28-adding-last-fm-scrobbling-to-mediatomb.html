<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Legacy blog post by Julien Simon">
  <meta name="author" content="Julien Simon">
  <meta name="robots" content="index, follow">
  
  <title>Adding Last Fm Scrobbling To Mediatomb â€“ Julien Simon</title>
  
  <!-- Umami Analytics -->
  <script>
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.src = 'https://cloud.umami.is/script.js';
      script.setAttribute('data-website-id', '27550dad-d418-4f5d-ad1b-dab573da1020');
      document.head.appendChild(script);
    });
  </script>
  
  <!-- Resource hints for faster DNS resolution and connections -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/social-icons.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
  
  <!-- Legacy post specific styles -->
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--background);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      text-align: center;
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 2px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      line-height: 1.2;
    }
    
    .legacy-post-meta {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }
    
    .legacy-post-date {
      background: var(--surface);
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
    }
    
    .legacy-post-category {
      background: var(--primary-color);
      color: white;
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
      text-transform: uppercase;
      font-size: var(--text-xs);
      letter-spacing: 0.5px;
    }
    
    .legacy-post-content {
      line-height: 1.8;
      color: var(--text-primary);
      font-size: var(--text-base);
    }
    
    .legacy-post-content h1,
    .legacy-post-content h2,
    .legacy-post-content h3,
    .legacy-post-content h4 {
      color: var(--text-primary);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
      font-weight: 600;
    }
    
    .legacy-post-content h1 { font-size: var(--text-2xl); }
    .legacy-post-content h2 { font-size: var(--text-xl); }
    .legacy-post-content h3 { font-size: var(--text-lg); }
    .legacy-post-content h4 { font-size: var(--text-base); }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin-bottom: var(--space-4);
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content code {
      background: var(--surface);
      color: var(--primary-color);
      padding: var(--space-1) var(--space-2);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: var(--space-4);
      overflow-x: auto;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-6) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .legacy-post-content a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .separator {
      clear: both;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
      background: var(--primary-color);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: var(--text-sm);
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">Adding Last Fm Scrobbling To Mediatomb</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">December 28, 2008</span>
            <span class="legacy-post-category">Linux & Ubuntu</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <p><a href="http://code.google.com/p/lastfmlib/">Lastfmlib</a> is C / C++ library allowing music applications to "scrobble" tracks on <a href="http://www.last.fm/">last.fm</a>.</p>

<p>A patch has been recently released to integrate this library with <a href="http://mediatomb.cc/"><span>mediatomb, so let's get to work :)</p>

<p>FYI, this is written using Ubuntu 8.04 and <span>mediatomb</span> 0.12 (SVN build 1997). I also assume you have a <span>mediatomb</span> source tree ready (if not, <a href="2008-12-22-compiling-mediatomb-ffmpegthumbnailer-all-libraries-ubuntu-ps3.html">here's how</a>).</p>

<p><span>1) Installing <span>lastfmlib</p>

<p>First of all, we need to fetch the <span>log4cpp</span> library, which is used by lastfmlib to log its actions (very useful for troubleshooting!).
<code>
ubuntu% <span>sudo apt-get install liblog4cpp5-dev
</code>Now, let's fetch the <span>lastfmlib</span> source (0.1.3 at the time of this writing) as well as the <span>mediatomb</span> patch:</p>

<p><code>ubuntu% <span>wget http://lastfmlib.googlecode.com/files/lastfmlib-0.1.3.tar.gz</span>
ubuntu% <span>wget http://lastfmlib.googlecode.com/svn/trunk/mediatomb.patch</span>
Building the library is very straightforward:
<code>
ubuntu% <span>tar xvfz lastfmlib-0.1.3.tar.gz</span>
ubuntu% <span>cd lastfmlib-0.1.3</span>
ubuntu% <span>./configure --prefix=/usr/local --enable-logging</span>
ubuntu% <span>make</span>
ubuntu% <span>sudo make install</span>
ubuntu% <span>sudo ldconfig</span><code>Done! Let's patch <span>mediatomb</span> now.</p>

<p><span>2) Patching &amp; building <span>mediatomb</span>
In the <span>mediatomb</span> source directory, let's apply the patch:<span>
<code>ubuntu% <span>patch -p0 All hunks should be successful. Now, run <span>configure</span> to take <span>lastfmlib</span> into account:<span>
<code>ubuntu% <span>./configure --prefix=/usr/local</span>
<span>output removed</span>
checking lastfmlib/lastfmscrobbler.h usability... yes
checking lastfmlib/lastfmscrobbler.h presence... yes
checking for lastfmlib/lastfmscrobbler.h... yes
<span>output removed</span>
CONFIGURATION SUMMARY ----
<span>output removed</span>
<span>lastfm                : yes</span>
<span>output removed</span>
OK, the library has been properly detected. Now, let's (re)build <span>mediatomb</span>:
<code>
ubuntu% <span>make clean</span>
ubuntu% <span>make</span>
ubuntu% <span>sudo make install</span>
<span>3) Configuring <span>mediatomb</p>

<p>In the <span>mediatomb</span> config file (<span>~/.mediatomb/config.xml</span>), we need to add this to the top-level <span></span> section:
<pre>&lt;lastfm enabled="yes"&gt;
&lt;username&gt;Your_LastFM_username&lt;/username&gt;
&lt;password&gt;Your_LastFM_password&lt;/password&gt;
&lt;/lastfm&gt;That's it :)</p>

<p><span>4) Testing!</span></p>

<p>Now, let's start <span>mediatomb</span>, fire up the PS3 (or whatever device you're streaming to) and play some <span>mp3</span> tracks.</p>

<p>In the <span>lastfmlib</span> log, you should see something similar to this:
<code>
ubuntu% <span>tail -f /tmp/lastfmliblog.txt</span>
1230460109 INFO  : Authentication successfull for user: <span>Your_LastFM_username</span>
1230460109 INFO  : Authenticate thread finished
1230462337 INFO  : startedPlaying Tanker Mot Tind (Gryning)
1230462517 INFO  : startedPlaying Ved Steingard
1230462517 INFO  : sendInfo thread started
1230462517 INFO  : Track "Tanker Mot Tind (Gryning)" can be committed: conditions OK
1230462517 INFO  : Buffered tracks submitted
1230462517 INFO  : sendInfo thread finished
And now the <span>mediatomb</span> console output:
<code>
2008-12-28 12:05:37    INFO: Artist: Borknagar
2008-12-28 12:05:37    INFO: Title: Tanker Mot Tind (Gryning)
2008-12-28 12:08:37    INFO: Artist: Borknagar
2008-12-28 12:08:37    INFO: Title: Ved Steingard
Of course, you can also log in on your <span>last.fm</span> account and see the tracks listed there. Pretty cool :)</p>

<p>One (very minor) gripe: scrobbling doesn't seem to work for file formats which are not natively handled by the PS3, notably FLAC. Maybe metadata extraction works differently for these files, as they need to be transcoded on the fly? Or have I missed something ? Anyway, I contacted the author about this, I'll post more details when I get them.</p>

<p>[Updated on 2009/01/02] Says Dirk Vanden Boer, the author of the library: "<span>I haven't tried playing files that need be transcoded yet, I'll take a look and see if a different code path is taken in case of transcoding</span>". I'll keep you posted.</p>

<p>That's it for today :)</p>
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>