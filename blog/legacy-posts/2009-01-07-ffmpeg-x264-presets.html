<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FFmpeg x264 Presets - Julien Simon</title>
  <meta name="description" content="How to use FFmpeg x264 preset files for H.264 video encoding with different quality settings and profiles.">
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="icon" href="../../assets/favicon.ico" type="image/x-icon">
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-3);
    }
    
    .legacy-post-meta {
      display: flex;
      gap: var(--space-4);
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content {
      line-height: 1.7;
      color: var(--text-primary);
    }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content h2 {
      font-size: var(--text-xl);
      font-weight: 600;
      color: var(--text-primary);
      margin: var(--space-6) 0 var(--space-4) 0;
      padding-top: var(--space-4);
      border-top: 1px solid var(--border);
    }
    
    .legacy-post-content h3 {
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: var(--space-5) 0 var(--space-3) 0;
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin: var(--space-4) 0;
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content pre {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--space-4);
      margin: var(--space-4) 0;
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content code {
      background: var(--code-bg);
      padding: 2px 4px;
      border-radius: var(--radius-sm);
      font-family: var(--font-mono);
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-4) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .legacy-post-content a:hover {
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius);
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">FFmpeg x264 Presets</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">January 7, 2009</span>
            <span class="legacy-post-category">Linux & Ubuntu</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <p>As discussed <a href="2008-12-27-quick-reference-on-audio-video-encoding-with-ffmpeg.html">earlier</a>, the FFmpeg command line can be quite daunting, especially when used to encode x264 video...</p>

          <p>Wouldn't it be nice to store your favorite options in a configuration file once and for all? Yes it would and yes you can!</p>

          <h2>Finding the FFmpeg / x264 preset files</h2>

          <p>Just head for the FFmpeg source and look at the ffpresets directory:</p>

          <pre><code>ubuntu% cd ffmpeg/ffpresets
ubuntu% ls
libx264-default.ffpreset        libx264-hq.ffpreset   libx264-normal.ffpreset
libx264-fastfirstpass.ffpreset  libx264-max.ffpreset</code></pre>

          <p>Nice. Let's copy these to your FFmpeg configuration directory:</p>

          <pre><code>ubuntu% mkdir ~/.ffmpeg
ubuntu% cp *.ffpreset ~/.ffmpeg</code></pre>

          <h2>A (terrifying) look at a preset file</h2>

          <p>What do you find in a preset file? Well, a long list of FFmpeg flags related to H.264 encoding:</p>

          <pre><code>ubuntu% cat libx264-normal.ffpreset
coder=1
flags=+loop
cmp=+chroma
partitions=+parti8x8+parti4x4+partp8x8+partb8x8
me_method=hex
subq=6
me_range=16
g=250
keyint_min=25
sc_threshold=40
i_qfactor=0.71
b_strategy=1
qcomp=0.6
qmin=10
qmax=51
qdiff=4
bf=16
refs=2
directpred=3
trellis=0
flags2=+bpyramid+wpred+dct8x8+fastpskip</code></pre>

          <p>Ouch! Welcome to the wonderful world of H.264 encoding ;)</p>

          <p>Keep in mind that these are FFmpeg flags (not x264 flags), so although they really are meant to configure the x264 encoding process, they differ from the actual flags that you would pass directly to the x264 encoder. To ease the pain of translating and understanding these flags, you will certainly need:</p>
          <ul>
            <li>this <a href="http://ffmpeg.x264.googlepages.com/mapping">mapping guide</a> written by one of the FFmpeg developers,</li>
            <li>this <a href="http://mediacoder.sourceforge.net/wiki/index.php/X264_Options_Explained">detailed list</a> of x264 flags, and I guess <a href="http://en.wikibooks.org/wiki/MeGUI/x264_Settings">this guide</a> too,</li>
            <li>the doom9 <a href="http://forum.doom9.org/forumdisplay.php?f=77">forum</a> on H.264.</li>
          </ul>

          <p>Don't worry, though. You really don't need to understand all these flags: the main reason for these preset files is obviously to define a number of typical x264 configurations which can be used out of the box.</p>

          <h2>Using a preset file</h2>

          <p>So how do you use a preset file? Just set the <code>-vpre</code> flag after the <code>-vcodec</code> flag (the flag order does matter):</p>

          <pre><code>ubuntu% ffmpeg -i video.mpg -vcodec libx264 -vpre normal video.mp4</code></pre>

          <p>Alternatively, you can set it to the full path to the preset file (useful if you don't want to keep them in <code>~/.ffmpeg</code>)</p>

          <pre><code>ubuntu% ffmpeg -i video.mpg -vcodec libx264 -vpre ~/myPresets/libx264-normal.ffpreset video.mp4</code></pre>

          <p>Easy, isn't it?</p>

          <p>Now let's look at the different preset files and run some tests. Here, I will encode a 3-minute MPEG video to H.264 using each of the available presets.</p>

          <p>Audio encoding is disabled (<code>-an</code>) and we let FFmpeg decide how many threads to run (<code>-threads 0</code>).</p>

          <h3>'Default quality' preset file</h3>

          <pre><code>ubuntu% ffmpeg -i video.mpg -f mp4 -vcodec libx264 -vpre default -an -threads 0 video.mp4</code></pre>
          <p>→ 39 seconds, 4.68 Mb</p>

          <p>As the name implies, settings are default values and generate a video compliant with the <strong>Main</strong> H.264 profile. If you need to encode to the <strong>Baseline</strong> profile, you just need to change <code>coder=1</code> to <code>coder=0</code> in the preset file: this will disable <a href="http://en.wikipedia.org/wiki/CABAC">CABAC entropy coding</a>, which is only supported in the <strong>Main</strong> profile and upwards.</p>

          <h3>'Normal quality' preset file</h3>
          <pre><code>ubuntu% ffmpeg -i video.mpg -f mp4 -vcodec libx264 -vpre normal -an -threads 0 video.mp4</code></pre>
          <p>→ 43 seconds, 4.67 Mb</p>

          <p>These settings bring a little bit more quality and generate a video compliant with the <strong>High</strong> H.264 profile. The key flags is <code>dct8x8</code>, which is only supported in the <strong>High</strong> profile and upwards: removing it will drop back to the <strong>Main</strong> profile.</p>

          <p>I would recommend this preset for everyday use.</p>

          <h3>'High quality' preset file</h3>
          <pre><code>ubuntu% ffmpeg -i video.mpg -f mp4 -vcodec libx264 -vpre hq -an -threads 0 video.mp4</code></pre>
          <p>→ 1 minute 26 seconds, 4.71 Mb</p>

          <p>These settings bring even more quality, notably a more accurate motion estimation method (<code>umh</code>) and <a href="http://en.wikipedia.org/wiki/Trellis_quantization">trellis quantization</a>. The output video is compliant with the <strong>High</strong> H.264 profile.</p>

          <p>Encoding time is 2x longer compared to the 'Normal quality' preset. Let your eyes decide if there's a notable improvement :)</p>

          <h3>'Maximum quality' preset file</h3>
          <pre><code>ubuntu% ffmpeg -i video.mpg -f mp4 -vcodec libx264 -vpre max -an -threads 0 video.mp4</code></pre>
          <p>→ 15 minutes 4 seconds, 4.72 Mb</p>

          <p>These settings bring a lot more quality, thanks to generous B-frames settings, a very efficient (but very slow) motion estimation method (<code>tesa</code>) and more <a href="http://en.wikipedia.org/wiki/Trellis_quantization">trellis quantization</a>. The output video is compliant with the <strong>High</strong> H.264 profile.</p>

          <p>Still, encoding time is 10x longer compared to the 'High quality' preset. Not sure it's really worth it...</p>

          <p>That's it for today. We barely scratched the surface and there's much more to be said on H.264, but hopefully this will get you started :)</p>

          <h2>Updated Preset Files</h2>

          <p><strong>Updated on 2009/01/19:</strong> a whole new bunch of lossless & iPod presets have surfaced!</p>

          <pre><code>libx264-baseline.ffpreset
libx264-default.ffpreset
libx264-fastfirstpass.ffpreset
libx264-hq.ffpreset
libx264-ipod320.ffpreset
libx264-ipod640.ffpreset
libx264-lossless_fast.ffpreset
libx264-lossless_max.ffpreset
libx264-lossless_medium.ffpreset
libx264-lossless_slower.ffpreset
libx264-lossless_slow.ffpreset
libx264-lossless_ultrafast.ffpreset
libx264-main.ffpreset
libx264-max.ffpreset
libx264-normal.ffpreset
libx264-slowfirstpass.ffpreset</code></pre>
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>