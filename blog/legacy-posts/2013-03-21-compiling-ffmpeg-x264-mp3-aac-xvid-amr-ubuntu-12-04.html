<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Legacy blog post by Julien Simon">
  <meta name="author" content="Julien Simon">
  <meta name="robots" content="index, follow">
  
  <title>Compiling Ffmpeg X264 Mp3 Aac Xvid Amr Ubuntu 12 04 â€“ Julien Simon</title>
  
  <!-- Umami Analytics -->
  <script>
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.src = 'https://cloud.umami.is/script.js';
      script.setAttribute('data-website-id', '27550dad-d418-4f5d-ad1b-dab573da1020');
      document.head.appendChild(script);
    });
  </script>
  
  <!-- Resource hints for faster DNS resolution and connections -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/social-icons.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
  
  <!-- Legacy post specific styles -->
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--background);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      text-align: center;
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 2px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      line-height: 1.2;
    }
    
    .legacy-post-meta {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }
    
    .legacy-post-date {
      background: var(--surface);
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
    }
    
    .legacy-post-category {
      background: var(--primary-color);
      color: white;
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
      text-transform: uppercase;
      font-size: var(--text-xs);
      letter-spacing: 0.5px;
    }
    
    .legacy-post-content {
      line-height: 1.8;
      color: var(--text-primary);
      font-size: var(--text-base);
    }
    
    .legacy-post-content h1,
    .legacy-post-content h2,
    .legacy-post-content h3,
    .legacy-post-content h4 {
      color: var(--text-primary);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
      font-weight: 600;
    }
    
    .legacy-post-content h1 { font-size: var(--text-2xl); }
    .legacy-post-content h2 { font-size: var(--text-xl); }
    .legacy-post-content h3 { font-size: var(--text-lg); }
    .legacy-post-content h4 { font-size: var(--text-base); }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin-bottom: var(--space-4);
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content code {
      background: var(--surface);
      color: var(--primary-color);
      padding: var(--space-1) var(--space-2);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: var(--space-4);
      overflow-x: auto;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-6) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .legacy-post-content a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .separator {
      clear: both;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
      background: var(--primary-color);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: var(--text-sm);
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">Compiling Ffmpeg X264 Mp3 Aac Xvid Amr Ubuntu 12 04</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">March 21, 2013</span>
            <span class="legacy-post-category">Linux & Ubuntu</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <p><em><strong>By popular demand (according to page view stats), I've decided to refresh the Dec'2008 post (<a href="2008-20-12-compiling-ffmeg-x264-mp3-xvid-amr-on-ubuntu.html">"HOWTO: compiling ffmpeg + x264 + MP3 + Xvid + AMR on Ubuntu 8.x"</a>) for Ubuntu 12.04. Enjoy :)</em></p>

          <p><strong>ffmpeg</strong> is THE audio/video conversion tool. Unfortunately, the default build included in Ubuntu is usually quite outdated, as well as lacking support for many codecs.</p>

          <p>The purpose of this article is to show you how you can build a fresh, up to date version of <strong>ffmpeg</strong> supporting (almost) all major codecs. This procedure was successfully performed on a vanilla Ubuntu 12.04 system.</p>

          <h3>0) Prerequisites</h3>

          <p>First, we need to enable the 'multiverse" repository in <em>/etc/apt/sources.list</em>, because that's where some of our external libraries live. All you have to do is uncomment the line similar to:</p>

          <pre><code>deb http://eu-west-1.ec2.archive.ubuntu.com/ubuntu/ precise multiverse</code></pre>

          <p>Don't forget to refresh the repos:</p>

          <pre><code>$ sudo <strong>apt-get</strong> update</code></pre>

          <p>Then, we need to make sure that <strong>git</strong> and <em>svn</em> are installed. We'll need them to fetch source code.</p>

          <pre><code>$ sudo <strong>apt-get</strong> install git subversion</code></pre>

          <p>Let's also add some mandatory build tools:</p>

          <pre><code>$ sudo <strong>apt-get</strong> install build-essential nasm pkg-config</code></pre>

          <p>Now would be a good time to decide where you're going to build all those sources. Just create a temporary directory anywhere you like (you'll need about 150MB).</p>

          <p>The <em>x264</em> build requires a recent version of the <em>yasm</em> assembler. Let's take care of it:</p>

          <pre><code>$ sudo <strong>apt-get</strong> remove yasm
$ <strong>wget</strong> http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz
$ <strong>tar</strong> xvfz yasm-1.2.0.tar.gz
$ cd yasm-1.2.0
$ ./<strong>configure</strong> --prefix=/usr/local
$ <strong>make</strong>
$ sudo <strong>make</strong> install
$ <strong>yasm</strong> --version
yasm 1.2.0 Compiled on Aug 21 2013.</code></pre>

          <p>Done! One final note before we start building: if you have an existing installation of <em>ffmpeg</em>, you may run into linking issues caused by conflicting library versions. My advice is to remove all existing copies of <em>libav*</em> (<em>libavcodec</em> and so on) which may be present in <em>/usr/lib</em>, either by uninstalling them with APT or by deleting the .a and .so files.</p>

          <h3>1) Fetching the ffmpeg sources</h3>

          <p>First of all, let's get the latest <strong>ffmpeg</strong> source:</p>

          <pre><code>$ <strong>git</strong> clone git://source.ffmpeg.org/ffmpeg.git ffmpeg</code></pre>

          <p>Of course, you could just go ahead with <code>configure</code>, <code>make</code>, <code>make install</code> and be done with it. Unfortunately, it's not that simple. Go ahead, run <code>configure</code>:</p>

          <pre><code>$ cd ffmpeg
$ ./<strong>configure</strong> --prefix=/usr/local
output removed
Creating config.mak and config.h...</code></pre>

          <p>Take a closer look at the output, especially at the 'Enabled encoders' section. A number of major formats, like AAC, MP3, x.264 or XViD are missing. Can you live without these? Probably not...</p>

          <p>Why, oh why are they missing? Take another look at the output of the <code>configure</code> command:</p>

          <pre><code>libfaac enabled no
libmp3lame enabled no
libx264 enabled no
libxvid enabled no</code></pre>

          <p>These encoders are missing because they're handled by external libraries which are not part of the <strong>ffmpeg</strong> source package. Chasing them all is a bit of a pain in the #$$ and hopefully this article will help!</p>

          <h3>2) Configuring ffmpeg... and failing</h3>

          <p>Let's go wild and enable these additional encoders: AAC, MP3, Theora, Vorbis, x264, xvid, AMR, GSM. Let's also build shared libraries, which are useful if you're running multiple copies of <strong>ffmpeg</strong>:</p>

          <pre><code>$ ./<strong>configure</strong> --prefix=/usr/local --enable-gpl --enable-version3 --enable-nonfree --enable-shared --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libgsm --enable-libmp3lame --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid</code></pre>

          <p>It will inevitably lead to something like:</p>

          <pre><code>ERROR: libfaac not found</code></pre>

          <p>That's ok, we haven't installed the external libraries required by our <strong>ffmpeg</strong> build. Let's get to it!</p>

          <h3>3) Installing AAC, MP3, Theora, Vorbis, AMR, GSM</h3>

          <p>These are readily available in the Ubuntu repository, let's add them:</p>

          <pre><code>$ sudo <strong>apt-get</strong> install libfaac-dev libmp3lame-dev libtheora-dev libvorbis-dev libopencore-amrnb-dev libopencore-amrwb-dev libgsm1-dev zlib1g-dev libgpac1-dev</code></pre>

          <h3>4) Installing <a href="http://www.videolan.org/developers/x264.html"><em>libx264</em></a></h3>

          <p>x264 is a free library for encoding H264/AVC video streams. It can be installed with APT using '<code>apt-get install libx264-dev</code>' but let's make sure we have both the latest <strong>ffmpeg</strong> and the latest <strong>x264</strong>.</p>

          <p>So, let's fetch the <strong>x264</strong> sources and build them:</p>

          <pre><code>$ <strong>git</strong> clone git://git.videolan.org/x264.git
$ cd x264
$ ./<strong>configure</strong> --prefix=/usr/local --enable-shared
$ <strong>make</strong>
$ sudo <strong>make</strong> install</code></pre>

          <h3>5) Installing <a href="http://www.xvid.org/">libxvid</a></h3>

          <p>Let's fetch the <strong>xvid</strong> sources and build them:</p>

          <pre><code>$ <strong>wget</strong> http://downloads.xvid.org/downloads/xvidcore-1.3.2.tar.gz
$ <strong>tar</strong> xvfz xvidcore-1.3.2.tar.gz
$ cd xvidcore-1.3.2/build/generic
$ ./<strong>configure</strong> --prefix=/usr/local
$ <strong>make</strong>
$ sudo <strong>make</strong> install</code></pre>

          <h3>6) Configuring ffmpeg... and succeeding!</h3>

          <p>We should have everything we need now. Let's try that <code>configure</code> command again:</p>

          <pre><code>$ ./<strong>configure</strong> --prefix=/usr/local --enable-gpl --enable-version3 --enable-nonfree --enable-shared --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libgsm --enable-libmp3lame --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid
output removed
Creating config.mak, config.h, and doc/config.texi...</code></pre>

          <p>All right, let's build it. Time for coffee(s), this is a rather long build:</p>

          <pre><code>$ <strong>make</strong>
$ sudo <strong>make</strong> install
$ sudo <strong>ldconfig</strong> -v</code></pre>

          <p>Cool, huh? Now, let's check this new <em>ffmpeg</em>:</p>

          <pre><code>$ <strong>which</strong> ffmpeg
/usr/local/bin/ffmpeg
$ <strong>ffmpeg</strong> -encoders|<strong>grep</strong> -E "mp3|xvid|aac|gsm|amr|x264|theora|vorbis"
ffmpeg version N-55691-gca7f637 Copyright (c) 2000-2013 the FFmpeg developers
  built on Aug 21 2013 15:44:17 with gcc 4.6 (Ubuntu/Linaro 4.6.3-1ubuntu5)
  configuration: --prefix=/usr/local --enable-gpl --enable-version3 --enable-nonfree --enable-shared --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libgsm --enable-libmp3lame --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid
  libavutil      52. 42.100 / 52. 42.100
  libavcodec     55. 29.100 / 55. 29.100
  libavformat    55. 14.100 / 55. 14.100
  libavdevice    55.  3.100 / 55.  3.100
  libavfilter     3. 82.100 /  3. 82.100
  libswscale      2.  5.100 /  2.  5.100
  libswresample   0. 17.103 /  0. 17.103
  libpostproc    52.  3.100 / 52.  3.100
V..... libx264             libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (codec h264)
V..... libx264rgb          libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 RGB (codec h264)
V..... libxvid             libxvidcore MPEG-4 part 2 (codec mpeg4)
V..... libtheora           libtheora Theora (codec theora)
A..X.. aac                 AAC (Advanced Audio Coding)
A..... libfaac             libfaac AAC (Advanced Audio Coding) (codec aac)
A..... libopencore_amrnb   OpenCORE AMR-NB (Adaptive Multi-Rate Narrow-Band) (codec amr_nb)
A..... libgsm              libgsm GSM (codec gsm)
A..... libgsm_ms           libgsm GSM Microsoft variant (codec gsm_ms)
A..... libmp3lame          libmp3lame MP3 (MPEG audio layer 3) (codec mp3)
A..X.. vorbis              Vorbis
A..... libvorbis           libvorbis (codec vorbis)</code></pre>

          <p>Congratulations, your brand new <em>ffmpeg</em> can now encode AAC, MP3, Theora, Vorbis, x264, xvid, AMR and GSM :)</p>

          <h3>7) Cleaning up (optional)</h3>

          <p>If like me you keep building the latest version, you will eventually end up with a lot of unnecessary libraries in <code>/usr/local/lib</code>. There's nothing really wrong with old versions, but for the sake of clarity, you may want to remove the old shared libraries, i.e. the ones NOT linked as lib*.so.</p>

          <p>That's it for today :)</p>
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>