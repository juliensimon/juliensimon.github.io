<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Legacy blog post by Julien Simon">
  <meta name="author" content="Julien Simon">
  <meta name="robots" content="index, follow">
  
  <title>Compiling Ffmpeg X264 Mp3 Aac Xvid Amr Ubuntu 12 04 â€“ Julien Simon</title>
  
  <!-- Umami Analytics -->
  <script>
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.src = 'https://cloud.umami.is/script.js';
      script.setAttribute('data-website-id', '27550dad-d418-4f5d-ad1b-dab573da1020');
      document.head.appendChild(script);
    });
  </script>
  
  <!-- Resource hints for faster DNS resolution and connections -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/social-icons.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
  
  <!-- Legacy post specific styles -->
  <style>
    .legacy-post-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
      background: var(--background);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
    }
    
    .legacy-post-header {
      text-align: center;
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 2px solid var(--border);
    }
    
    .legacy-post-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      line-height: 1.2;
    }
    
    .legacy-post-meta {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }
    
    .legacy-post-date {
      background: var(--surface);
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
    }
    
    .legacy-post-category {
      background: var(--primary-color);
      color: white;
      padding: var(--space-2) var(--space-3);
      border-radius: 6px;
      font-weight: 500;
      text-transform: uppercase;
      font-size: var(--text-xs);
      letter-spacing: 0.5px;
    }
    
    .legacy-post-content {
      line-height: 1.8;
      color: var(--text-primary);
      font-size: var(--text-base);
    }
    
    .legacy-post-content h1,
    .legacy-post-content h2,
    .legacy-post-content h3,
    .legacy-post-content h4 {
      color: var(--text-primary);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
      font-weight: 600;
    }
    
    .legacy-post-content h1 { font-size: var(--text-2xl); }
    .legacy-post-content h2 { font-size: var(--text-xl); }
    .legacy-post-content h3 { font-size: var(--text-lg); }
    .legacy-post-content h4 { font-size: var(--text-base); }
    
    .legacy-post-content p {
      margin-bottom: var(--space-4);
    }
    
    .legacy-post-content ul,
    .legacy-post-content ol {
      margin-bottom: var(--space-4);
      padding-left: var(--space-6);
    }
    
    .legacy-post-content li {
      margin-bottom: var(--space-2);
    }
    
    .legacy-post-content code {
      background: var(--surface);
      color: var(--primary-color);
      padding: var(--space-1) var(--space-2);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--text-sm);
    }
    
    .legacy-post-content pre {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: var(--space-4);
      overflow-x: auto;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
    }
    
    .legacy-post-content blockquote {
      border-left: 4px solid var(--primary-color);
      padding-left: var(--space-4);
      margin: var(--space-6) 0;
      font-style: italic;
      color: var(--text-secondary);
    }
    
    .legacy-post-content a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .legacy-post-content a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }
    
    .legacy-post-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .separator {
      clear: both;
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content .gist {
      margin: var(--space-4) 0;
    }
    
    .legacy-post-content table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-6) 0;
    }
    
    .legacy-post-content th,
    .legacy-post-content td {
      padding: var(--space-2) var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .legacy-post-content th {
      background: var(--surface);
      font-weight: 600;
    }
    
    .legacy-post-content strong,
    .legacy-post-content b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .legacy-post-content em,
    .legacy-post-content i {
      font-style: italic;
    }
    
      background: var(--primary-color);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: var(--text-sm);
    }
    
    @media (max-width: 768px) {
      .legacy-post-container {
        padding: var(--space-4);
        margin: var(--space-4);
      }
      
      .legacy-post-title {
        font-size: var(--text-2xl);
      }
      
      .legacy-post-meta {
        flex-direction: column;
        gap: var(--space-2);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="../../assets/julien.webp" alt="Julien Simon" class="profile-image">
      <h1>Julien Simon</h1>
      <p class="title">Chief Evangelist @ Arcee AI</p>
      <p class="subtitle">World Expert in Practical AI</p>
    </header>

    <main>
      <article class="legacy-post-container">
        <header class="legacy-post-header">
          <h1 class="legacy-post-title">Compiling Ffmpeg X264 Mp3 Aac Xvid Amr Ubuntu 12 04</h1>
          <div class="legacy-post-meta">
            <span class="legacy-post-date">March 21, 2013</span>
            <span class="legacy-post-category">Linux & Ubuntu</span>
          </div>
        </header>
        
        <div class="legacy-post-content">
          <i><span><b>By popular demand (according to page view stats), I've decided to refresh the Dec'2008 post (<a href="2008-20-12-compiling-ffmeg-x264-mp3-xvid-amr-on-ubuntu.html">"HOWTO: compiling ffmpeg + x264 + MP3 + Xvid + AMR on Ubuntu 8.x"</a>)&nbsp;for Ubuntu 12.04. Enjoy :)</i><br />
<span>
<span><span>ffmpeg&nbsp;</span><span>is THE audio/video conversion tool. Unfortunately, the default build included in Ubuntu is usually quite outdated, as well as lacking support for many codecs.</span><br /><br /><span>The purpose of this article is to show you how you can build a fresh, up to date version of&nbsp;</span><span>ffmpeg&nbsp;</span><span>supporting (almost) all major codecs. This procedure was successfully performed on a vanilla Ubuntu 12.04 system.<br />
<br />
<span><span>0) Prerequisites</span><br /><br />First, we need to enable the 'multiverse" repository in <i>/etc/apt/sources.list, </i>because that's where some of our external libraries live.&nbsp;All you have to do is </span><span>uncomment the line similar to:</span><br />
<span>add deb http://eu-west-1.ec2.archive.ubuntu.com/ubuntu/ precise multiverse sudo apt-get update</span><br />
<span>
Don't forget to refresh the repos:<br />
<span>$ sudo <b>apt-get</b>&nbsp;</span><span>update</span><br />
<br />
<span>Then</span><span>, we need to make sure that </span><span><span>git<span>&nbsp;and <i>svn</i> are installed. We'll need them to fetch source code.</span><br />
<span>$ sudo <b>apt-get</b> install git subversion</span><br />
<span>
<span>Let's also add some mandatory build tools:</span><br />
<span>$&nbsp;sudo <b>apt-get</b>&nbsp;install build-essential nasm pkg-config&nbsp;</span><br />
<br />
<span>Now would be a good time to decide where you're going to build all those sources. Just create a temporary directory anywhere you like (you'll need about 150MB).</span><br />
<br />
<span>The <i>x264</i> build requires a recent version of the <i>yasm</i> assembler. Let's take care of it:</span><br />
<span>$ sudo <b>apt-get</b> remove yasm&nbsp;</span><br />
<span>$ <b>wget</b> http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz&nbsp;</span><br />
<span>$ <b>tar</b> xvfz yasm-1.2.0.tar.gz&nbsp;</span><br />
<span>$ cd yasm-1.2.0&nbsp;</span><br />
<span>$ ./<b>configure</b> --prefix=/usr/local&nbsp;</span><br />
<span>$ <b>make</b>&nbsp;</span><br />
<span>$ sudo <b>make</b> install&nbsp;</span><br />
<span>$ <b>yasm</b> --version</span><br />
<span>yasm 1.2.0 Compiled on Aug 21 2013.&nbsp;</span><br />
<span><br /><span>Done!&nbsp;</span><span>One final note before we start building: if you have an existing installation of <i>ffmpeg</i>, you may run into linking issues caused by conflicting library versions. My advice is to remove all existing copies of <i>libav</i>* (<i>libavcodec</i> and so on) which may be present&nbsp;</span><span>in <i>/usr/lib</i>, either by uninstalling them with APT or by deleting the .a and .so files.<br />
<span><span><span>1) Fetching the&nbsp;<span>ffmpeg</span>&nbsp;sources</span><br /><br /><span>First of all, let's get the latest&nbsp;</span><span>ffmpeg</span><span>&nbsp;source:</span><code></span><span>$ <b>git </b>clone git://source.ffmpeg.org/ffmpeg.git ffmpeg</span><br />
<span>
<span>Of course, you could just go ahead with&nbsp;</span><span>configure</span><span>,&nbsp;</span><span>make</span><span>,&nbsp;</span><span>make install</span><span>&nbsp;and be done with it. Unfortunately, it's not that simple. Go ahead, run&nbsp;</span><span>configure</span><span>:</span><br />
<code><br /><span>$&nbsp;cd ffmpeg<br />$./<b>configure</b>&nbsp;<code><span>--prefix=/usr/local<code><span><br /><span>output removed</span><br />Creating config.mak and config.h...<br />
<span>Take a closer look at the output, especially at the '</span><span>Enabled encoders</span><span>' section. A number of major formats, like AAC, MP3, x.264 or XViD are missing. Can you live without these? Probably not...</span><br />
<br />
<span>Why, oh why are they missing? Take another look at the output of the&nbsp;</span><span>configure</span><span>&nbsp;command:</span><br />
<code><span>libfaac enabled no<br />libmp3lame enabled no<br />libx264 enabled no<br />libxvid enabled no<br />
<span>These encoders are missing because they're handled by external libraries which are not part of the&nbsp;</span><span>ffmpeg</span><span>&nbsp;source package. Chasing them all is a bit of a pain in the #$$ and hopefully this article will help!</span><br />
<br />
<span><span><span>2) Configuring&nbsp;<span>ffmpeg</span>... and failing</span><br />
<span>
<span>Let's go wild and enable these additional encoders:&nbsp;</span>AAC, MP3, Theora, Vorbis, x264, xvid, AMR, GSM. Let's also build<span>&nbsp;shared libraries, which are useful if you're running multiple copies of&nbsp;</span><span>ffmpeg</span><span>:</span><br />
<span>
<span><span>$&nbsp;</span>./<b>configure</b> --prefix=/usr/local --enable-gpl --enable-version3 --enable-nonfree --enable-shared --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libgsm --enable-libmp3lame --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid&nbsp;</span><br />
<br />
<span>It will inevitably lead to something like:</span><br />
<span><span>ERROR: libfaac not found<br />
<div>
<span>That's ok, we haven't installed the external libraries required by our&nbsp;</span><span>ffmpeg</span><span>&nbsp;build. Let's get to it!</span><br />
<br />
<span><b><span>3) Installing&nbsp;</span><span>AAC, MP3, Theora, Vorbis, AMR, GSM</span><br />
<span><b><span>
<span>These are readily available in the Ubuntu repository, let's add them:</span><br />
<span><span>$ sudo <b>apt-get</b> install libfaac-dev libmp3lame-dev libtheora-dev libvorbis-dev libopencore-amrnb-dev libopencore-amrwb-dev libgsm1-dev zlib1g-dev libgpac1-dev<br />
<br />
<span>4) Installing&nbsp;</span><a href="http://www.videolan.org/developers/x264.html"><i>libx264<span></span><br />
<br />
<span>x264 is a free library for encoding H264/AVC video streams.&nbsp;</span><span>It can be installed with APT using '</span><span>apt-get install libx264-dev</span><span>' but let's make sure we have both the latest&nbsp;</span><span>ffmpeg</span><span>&nbsp;and the latest&nbsp;</span><span>x264</span><span>.</span><br />
<br />
<span>So, let's fetch the&nbsp;</span><span>x264</span><span>&nbsp;sources and build them:</span><br />
<code><span>$&nbsp;<b>git</b> clone git://git.videolan.org/x264.git<br />$&nbsp;cd x264<code><span></code><code><span>$ ./<b>configure</b> --prefix=/usr/local --enable-shared<br />$&nbsp;<b>make</b><br />$&nbsp;sudo <b>make</b> install<br />
<code><span></code>
<span>5) Installing&nbsp;</span><a href="http://www.xvid.org/">libxvid</a><br />
<span>
<span>Let's fetch the&nbsp;</span><span>xvid</span><span>&nbsp;sources and build them:</span><br />
<code><span><span>$ <b>wget</b> http://downloads.xvid.org/downloads/xvidcore-1.3.2.tar.gz&nbsp;</code><br />
<code><span><span>$ <b>tar</b> xvfz xvidcore-1.3.2.tar.gz&nbsp;</code><br />
<code><span><span>$ cd xvidcore-1.3.2/build/generic&nbsp;</code><br />
<code><span><span>$ ./<b>configure</b> --prefix=/usr/local&nbsp;</code><br />
<code><span><span>$ <b>make<br />
<code><span><span>$ sudo <b>make</b> install</code><br />
<code><span></code><span>6) Configuring&nbsp;<span>ffmpeg</span>... and succeeding!</span><br />
<code><span>We should have everything we need now. Let's try that&nbsp;</span><span>configure</span><span>&nbsp;command again:</span><br />
<code><span>$&nbsp;</span><span>./</span><b>configure</b><span>&nbsp;--prefix=/usr/local --enable-gpl --enable-version3 --enable-nonfree --enable-shared --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libgsm --enable-libmp3lame --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid<br />
<code><span><span>output removed</code><br />
<span>Creating config.mak, config.h, and doc/config.texi...</span><br />
<div>
<span>All right, let's build it. Time for coffee(s), this is a rather long build:</span><span><span>$ <b>make<br />
<span><span>$ sudo <b>make</b> install<br />
<span><span>$ sudo <b>ldconfig</b> -v<br />
<span><span></span>
<span><span>Cool, huh? Now, let's check this new <i>ffmpeg</i>:<br />
<code><span>$&nbsp;<b>which</b> ffmpeg<br />/usr/local/bin/ffmpeg<br />
<span>$ <b>ffmpeg</b> -encoders|<b>grep</b> -E "mp3|xvid|aac|gsm|amr|x264|theora|vorbis"</span><br />
<span><span>ffmpeg version N-55691-gca7f637 Copyright (c) 2000-2013 the FFmpeg developers<br />
<span><span>&nbsp; built on Aug 21 2013 15:44:17 with gcc 4.6 (Ubuntu/Linaro 4.6.3-1ubuntu5)<br />
<span><span>&nbsp; configuration: --prefix=/usr/local --enable-gpl --enable-version3 --enable-nonfree --enable-shared --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libgsm --enable-libmp3lame --enable-libtheora --enable-libvorbis --enable-libx264 --enable-libxvid<br />
<span><span>&nbsp; libavutil &nbsp; &nbsp; &nbsp;52. 42.100 / 52. 42.100<br />
<span><span>&nbsp; libavcodec &nbsp; &nbsp; 55. 29.100 / 55. 29.100<br />
<span><span>&nbsp; libavformat &nbsp; &nbsp;55. 14.100 / 55. 14.100<br />
<span><span>&nbsp; libavdevice &nbsp; &nbsp;55. &nbsp;3.100 / 55. &nbsp;3.100<br />
<span><span>&nbsp; libavfilter &nbsp; &nbsp; 3. 82.100 / &nbsp;3. 82.100<br />
<span><span>&nbsp; libswscale &nbsp; &nbsp; &nbsp;2. &nbsp;5.100 / &nbsp;2. &nbsp;5.100<br />
<span><span>&nbsp; libswresample &nbsp; 0. 17.103 / &nbsp;0. 17.103<br />
<span><span>&nbsp; libpostproc &nbsp; &nbsp;52. &nbsp;3.100 / 52. &nbsp;3.100<br />
<span><span>&nbsp;V..... libx264 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (codec h264)<br />
<span><span>&nbsp;V..... libx264rgb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 RGB (codec h264)<br />
<span><span>&nbsp;V..... libxvid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libxvidcore MPEG-4 part 2 (codec mpeg4)<br />
<span><span>&nbsp;V..... libtheora &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libtheora Theora (codec theora)<br />
<span><span>&nbsp;A..X.. aac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AAC (Advanced Audio Coding)<br />
<span><span>&nbsp;A..... libfaac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libfaac AAC (Advanced Audio Coding) (codec aac)<br />
<span><span>&nbsp;A..... libopencore_amrnb &nbsp; &nbsp;OpenCORE AMR-NB (Adaptive Multi-Rate Narrow-Band) (codec amr_nb)<br />
<span><span>&nbsp;A..... libgsm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libgsm GSM (codec gsm)<br />
<span><span>&nbsp;A..... libgsm_ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libgsm GSM Microsoft variant (codec gsm_ms)<br />
<span><span>&nbsp;A..... libmp3lame &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libmp3lame MP3 (MPEG audio layer 3) (codec mp3)<br />
<span><span>&nbsp;A..X.. vorbis &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Vorbis<br />
<span><span>&nbsp;A..... libvorbis &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libvorbis (codec vorbis)<br />
<span><span></span>
<span><span>Congratulations, your brand new <i>ffmpeg</i> can now encode AAC, MP3, Theora, Vorbis, x264, xvid, AMR and GSM :)<br />
<br />
<span>7) Cleaning up (optional)</span><code><span><span><span>If like me you keep building the latest version, you will eventually end up with a lot of&nbsp;<span><span>unnecessary<span><span>&nbsp;libraries in&nbsp;</span><span>/usr/local/lib.&nbsp;</span><span>There's nothing really wrong with old versions, but for the sake of clarity, you may want to remove the old shared libraries, i.e. the ones NOT linked as lib*.so.</span><br />
<span><br /><span>That's it for today :)
        </div>
      </article>
    </main>

    <footer>
      <nav>
        <a href="../../index.html">Home</a>
        <a href="../../experience.html">Experience</a>
        <a href="../../publications.html">Publications</a>
        <a href="../../code.html">Code</a>
        <a href="../../books.html">Books</a>
        <a href="../../youtube.html">YouTube</a>
        <a href="../../computers.html">Computers</a>
        <a href="../../legacy-posts.html">Legacy Posts</a>
      </nav>
    </footer>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>