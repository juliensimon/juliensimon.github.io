<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <!-- Primary Meta Tags -->
  <title>Amazon SageMaker Processing – Fully Managed Data Processing and Model Evaluation - Julien Simon | AWS Expert</title>
  <meta name="title" content="Amazon SageMaker Processing – Fully Managed Data Processing and Model Evaluation - Julien Simon | AWS Expert"/>
  <meta name="description" content="Expert analysis and technical deep-dive on amazon sagemaker processing – fully managed data processing and model evaluation by Julien Simon, leading AWS expert and former Global Technical Evangelist for AI & ML at Amazon Web Services."/>
  <meta name="keywords" content="AWS, Amazon Web Services, ['Amazon', 'SageMaker', 'Processing'], machine learning, AI, cloud computing, Julien Simon, AWS expert"/>
  <meta name="author" content="Julien Simon"/>
  <meta name="robots" content="index, follow"/>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article"/>
  <meta property="og:url" content="https://julien.org/blog/amazon-sagemaker-processing-fully-managed-data-processing-and-model-evaluation/"/>
  <meta property="og:title" content="Amazon SageMaker Processing – Fully Managed Data Processing and Model Evaluation - Julien Simon | AWS Expert"/>
  <meta property="og:description" content="Expert analysis and technical deep-dive on amazon sagemaker processing – fully managed data processing and model evaluation by Julien Simon, leading AWS expert and former Global Technical Evangelist for AI & ML at Amazon Web Services."/>
  <meta property="og:image" content="https://julien.org/assets/julien-simon-aws-expert.jpg"/>
  <meta property="og:site_name" content="Julien Simon - AWS Expert"/>
  <meta property="article:author" content="Julien Simon"/>
  <meta property="article:published_time" content="2019-12-03T00:00:00Z"/>
  <meta property="article:section" content="AWS"/>
  <meta property="article:tag" content="AWS, Amazon Web Services, Machine Learning, AI"/>
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image"/>
  <meta property="twitter:url" content="https://julien.org/blog/amazon-sagemaker-processing-fully-managed-data-processing-and-model-evaluation/"/>
  <meta property="twitter:title" content="Amazon SageMaker Processing – Fully Managed Data Processing and Model Evaluation - Julien Simon | AWS Expert"/>
  <meta property="twitter:description" content="Expert analysis and technical deep-dive on amazon sagemaker processing – fully managed data processing and model evaluation by Julien Simon, leading AWS expert and former Global Technical Evangelist for AI & ML at Amazon Web Services."/>
  <meta property="twitter:image" content="https://julien.org/assets/julien-simon-aws-expert.jpg"/>
  <meta property="twitter:creator" content="@julsimon"/>
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://julien.org/blog/amazon-sagemaker-processing-fully-managed-data-processing-and-model-evaluation/"/>
  
  <!-- Author and Publisher -->
  <link rel="author" href="https://julien.org/"/>
  <link rel="publisher" href="https://julien.org/"/>
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Amazon SageMaker Processing – Fully Managed Data Processing and Model Evaluation",
    "description": "Expert analysis and technical deep-dive on amazon sagemaker processing – fully managed data processing and model evaluation by Julien Simon, leading AWS expert and former Global Technical Evangelist for AI & ML at Amazon Web Services.",
    "image": "https://julien.org/assets/julien-simon-aws-expert.jpg",
    "author": {
      "@type": "Person",
      "name": "Julien Simon",
      "url": "https://julien.org/",
      "jobTitle": "AWS Expert & Former Global Technical Evangelist",
      "worksFor": {
        "@type": "Organization",
        "name": "Amazon Web Services"
      },
      "sameAs": [
        "https://twitter.com/julsimon",
        "https://linkedin.com/in/juliensimon",
        "https://github.com/juliensimon"
      ]
    },
    "publisher": {
      "@type": "Organization",
      "name": "Julien Simon",
      "url": "https://julien.org/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://julien.org/assets/julien-simon-logo.jpg"
      }
    },
    "datePublished": "2019-12-03T00:00:00Z",
    "dateModified": "2019-12-03T00:00:00Z",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://julien.org/blog/amazon-sagemaker-processing-fully-managed-data-processing-and-model-evaluation/"
    },
    "url": "https://julien.org/blog/amazon-sagemaker-processing-fully-managed-data-processing-and-model-evaluation/",
    "keywords": "AWS, Amazon Web Services, ['Amazon', 'SageMaker', 'Processing'], machine learning, AI, cloud computing, Julien Simon, AWS expert",
    "articleSection": "AWS",
    "inLanguage": "en-US",
    "isPartOf": {
      "@type": "Blog",
      "name": "Julien Simon - AWS Expert Blog",
      "url": "https://julien.org/blog/"
    }
  }
  </script>
  
  <!-- Additional SEO Meta Tags -->
  <meta name="twitter:site" content="@julsimon"/>
  <meta name="twitter:creator" content="@julsimon"/>
  <meta name="theme-color" content="#FF9900"/>
  <meta name="msapplication-TileColor" content="#FF9900"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  
  <!-- Preconnect to external domains -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="https://julien.org/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://julien.org/apple-touch-icon.png"/>
  
  <style>
   body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #2c3e50;
            margin-top: 2em;
            margin-bottom: 0.5em;
        }
        h1 { font-size: 2.5em; }
        h2 { font-size: 2em; }
        h3 { font-size: 1.5em; }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 1em 0;
        }
        /* Image alignment classes for text wraparound */
        img.alignleft {
            float: left;
            margin: 0.5em 1.5em 1em 0;
        }
        img.alignright {
            float: right;
            margin: 0.5em 0 1em 1.5em;
        }
        img.aligncenter {
            display: block;
            margin: 1em auto;
            float: none;
        }
        img.alignnone {
            float: none;
            margin: 1em 0;
        }
        /* Clear floats after images */
        .wp-block-image::after,
        p:has(img.alignleft)::after,
        p:has(img.alignright)::after {
            content: "";
            display: table;
            clear: both;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1em;
            overflow-x: auto;
        }
        code {
            background: #f8f9fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        blockquote {
            border-left: 4px solid #3498db;
            margin: 1em 0;
            padding-left: 1em;
            font-style: italic;
            color: #7f8c8d;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        p {
            margin-bottom: 1em;
        }
        .author-bio {
            background: #f8f9fa;
            border-left: 4px solid #FF9900;
            padding: 1em;
            margin: 2em 0;
            border-radius: 4px;
        }
        .author-bio h3 {
            margin-top: 0;
            color: #FF9900;
        }
        
  </style>
 </head>
 <body>
  <div style="margin-bottom: 1em;">
  <a href="../../../aws-blog-posts.html" style="color: #FF9900; text-decoration: none; font-size: 0.9em;">← Back to AWS Blog Posts</a>
</div>
  
  <h1>Amazon SageMaker Processing – Fully Managed Data Processing and Model Evaluation</h1>
  
    
  
  <p style="color: #666; font-style: italic; margin-bottom: 1em;">
   Published: 2019-12-03 | Originally published at <a href="https://aws.amazon.com/blogs/aws/amazon-sagemaker-processing-fully-managed-data-processing-and-model-evaluation/" target="_blank" rel="noopener noreferrer">AWS Blog</a>
  </p>
 <body>
  <p>
   Today, we’re extremely happy to launch Amazon SageMaker Processing, a new capability of
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker
   </a>
   that lets you easily run your preprocessing, postprocessing and model evaluation workloads on fully managed infrastructure.
  </p>
  <p>
   Training an accurate machine learning (ML) model requires many different steps, but none is potentially more important than preprocessing your data set, e.g.:
  </p>
  <ul>
   <li>
    Converting the data set to the input format expected by the ML algorithm you’re using,
   </li>
   <li>
    Transforming existing features to a more expressive representation, such as one-hot encoding categorical features,
   </li>
   <li>
    Rescaling or normalizing numerical features,
   </li>
   <li>
    Engineering high level features, e.g. replacing mailing addresses with GPS coordinates,
   </li>
   <li>
    Cleaning and tokenizing text for natural language processing applications,
   </li>
   <li>
    And more!
   </li>
  </ul>
  <p>
   These tasks involve running bespoke scripts on your data set, (beneath a moonless sky, I’m told) and saving the processed version for later use by your training jobs. As you can guess, running them manually or having to build and scale automation tools is not an exciting prospect for ML teams. The same could be said about postprocessing jobs (filtering, collating, etc.) and model evaluation jobs (scoring models against different test sets).
  </p>
  <p>
   Solving this problem is why we built
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker Processing
   </a>
   . Let me tell you more.
  </p>
  <p>
   <strong>
    <span style="text-decoration: underline;">
     Introducing Amazon SageMaker Processing
    </span>
   </strong>
   <br/>
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker Processing
   </a>
   introduces a new Python SDK that lets data scientists and ML engineers easily run preprocessing, postprocessing and model evaluation workloads on
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker
   </a>
   .
  </p>
  <p>
   This SDK uses SageMaker’s built-in container for
   <a href="https://scikit-learn.org">
    scikit-learn
   </a>
   , possibly the most popular library one for
   <a href="https://scikit-learn.org/stable/data_transforms.html">
    data set transformation
   </a>
   .
  </p>
  <p>
   If you need something else, you also have the ability to use your own Docker images without having to conform to any Docker image specification: this gives you maximum flexibility in running any code you want, whether on
   <span title="Amazon SageMaker Processing">
    SageMaker Processing
   </span>
   , on AWS container services like
   <a href="https://aws.amazon.com/ecs/">
    Amazon Elastic Container Service (Amazon ECS)
   </a>
   and
   <a href="https://aws.amazon.com/eks/">
    Amazon Elastic Kubernetes Service (Amazon EKS)
   </a>
   , or even on premise.
  </p>
  <p>
   How about a quick demo with scikit-learn? Then, I’ll briefly discuss using your own container. Of course, you’ll find complete examples on
   <a href="https://github.com/awslabs/amazon-sagemaker-examples">
    Github
   </a>
   .
  </p>
  <p>
   <strong>
    <span style="text-decoration: underline;">
     Preprocessing Data With The Built-In Scikit-Learn Container
    </span>
   </strong>
   <br/>
   Here’s how to use the
   <span title="Amazon SageMaker Processing">
    SageMaker Processing
   </span>
   SDK to run your scikit-learn jobs.
  </p>
  <p>
   First, let’s create an
   <code>
    SKLearnProcessor
   </code>
   object, passing the scikit-learn version we want to use, as well as our managed infrastructure requirements.
  </p>
  <pre><code class="lang-python">from sagemaker.sklearn.processing import SKLearnProcessor
sklearn_processor = SKLearnProcessor(framework_version='0.20.0',
                                     role=role,
                                     instance_count=1,
                                     instance_type='ml.m5.xlarge')</code></pre>
  <p>
   Then, we can run our preprocessing script (more on this fellow in a minute) like so:
  </p>
  <ul>
   <li>
    The data set (
    <code>
     dataset.csv
    </code>
    ) is automatically copied inside the container under the destination directory (
    <code>
     /input
    </code>
    ). We could add additional inputs if needed.
   </li>
   <li>
    This is where the Python script (
    <code>
     preprocessing.py
    </code>
    ) reads it. Optionally, we could pass command line arguments to the script.
   </li>
   <li>
    It preprocesses it, splits it three ways, and saves the files inside the container under
    <code>
     /opt/ml/processing/output/train
    </code>
    ,
    <code>
     /opt/ml/processing/output/validation
    </code>
    , and
    <code>
     /opt/ml/processing/output/test
    </code>
    .
   </li>
   <li>
    Once the job completes, all outputs are automatically copied to your default
    <span title="Amazon SageMaker">
     SageMaker
    </span>
    bucket in S3.
   </li>
  </ul>
  <pre><code class="lang-python">from sagemaker.processing import ProcessingInput, ProcessingOutput
sklearn_processor.run(
    code='preprocessing.py',
    # arguments = ['arg1', 'arg2'],
    inputs=[ProcessingInput(
        source='dataset.csv',
        destination='/opt/ml/processing/input')],
    outputs=[ProcessingOutput(source='/opt/ml/processing/output/train'),
        ProcessingOutput(source='/opt/ml/processing/output/validation'),
        ProcessingOutput(source='/opt/ml/processing/output/test')]
)</code></pre>
  <p>
   That’s it! Let’s put everything together by looking at the skeleton of the preprocessing script.
  </p>
  <pre><code class="lang-python">import pandas as pd
from sklearn.model_selection import train_test_split
# Read data locally 
df = pd.read_csv('/opt/ml/processing/input/dataset.csv')
# Preprocess the data set
downsampled = apply_mad_data_science_skills(df)
# Split data set into training, validation, and test
train, test = train_test_split(downsampled, test_size=0.2)
train, validation = train_test_split(train, test_size=0.2)
# Create local output directories
try:
    os.makedirs('/opt/ml/processing/output/train')
    os.makedirs('/opt/ml/processing/output/validation')
    os.makedirs('/opt/ml/processing/output/test')
except:
    pass
# Save data locally
train.to_csv("/opt/ml/processing/output/train/train.csv")
validation.to_csv("/opt/ml/processing/output/validation/validation.csv")
test.to_csv("/opt/ml/processing/output/test/test.csv")
print('Finished running processing job')</code></pre>
  <p>
   A quick look to the S3 bucket confirms that files have been successfully processed and saved. Now I could use them directly as input for a
   <span title="Amazon SageMaker">
    SageMaker
   </span>
   training job.
  </p>
  <p>
   <code>
    $ aws s3 ls --recursive s3://sagemaker-us-west-2-123456789012/sagemaker-scikit-learn-2019-11-20-13-57-17-805/output
   </code>
   <br/>
   <code>
    2019-11-20 15:03:22 19967 sagemaker-scikit-learn-2019-11-20-13-57-17-805/output/test.csv
   </code>
   <br/>
   <code>
    2019-11-20 15:03:22 64998 sagemaker-scikit-learn-2019-11-20-13-57-17-805/output/train.csv
   </code>
   <br/>
   <code>
    2019-11-20 15:03:22 18058 sagemaker-scikit-learn-2019-11-20-13-57-17-805/output/validation.csv
   </code>
  </p>
  <p>
   Now what about using your own container?
  </p>
  <p>
   <strong>
    <span style="text-decoration: underline;">
     Processing Data With Your Own Container
    </span>
   </strong>
   <br/>
   Let’s say you’d like to preprocess text data with the popular
   <a href="https://spacy.io/">
    spaCy
   </a>
   library. Here’s how you could define a vanilla Docker container for it.
  </p>
  <pre><code class="lang-bash">FROM python:3.7-slim-buster
# Install spaCy, pandas, and an english language model for spaCy.
RUN pip3 install spacy==2.2.2 &amp;&amp; pip3 install pandas==0.25.3
RUN python3 -m spacy download en_core_web_md
# Make sure python doesn't buffer stdout so we get logs ASAP.
ENV PYTHONUNBUFFERED=TRUE
ENTRYPOINT ["python3"]</code></pre>
  <p>
   Then, you would build the Docker container, test it locally, and push it to
   <a href="https://aws.amazon.com/ecr/">
    Amazon Elastic Container Registry (Amazon ECR)
   </a>
   , our managed Docker registry service.
  </p>
  <p>
   The next step would be to configure a processing job using the
   <code>
    ScriptProcessor
   </code>
   object, passing the name of the container you built and pushed.
  </p>
  <pre><code class="lang-python">from sagemaker.processing import ScriptProcessor
script_processor = ScriptProcessor(image_uri='123456789012.dkr.ecr.us-west-2.amazonaws.com/sagemaker-spacy-container:latest',
                role=role,
                instance_count=1,
                instance_type='ml.m5.xlarge')</code></pre>
  <p>
   Finally, you would run the job just like in the previous example.
  </p>
  <pre><code class="lang-python">script_processor.run(code='spacy_script.py',
    inputs=[ProcessingInput(
        source='dataset.csv',
        destination='/opt/ml/processing/input_data')],
    outputs=[ProcessingOutput(source='/opt/ml/processing/processed_data')],
    arguments=['tokenizer', 'lemmatizer', 'pos-tagger']
)</code></pre>
  <p>
   The rest of the process is exactly the same as above: copy the input(s) inside the container, copy the output(s) from the container to S3.
  </p>
  <p>
   Pretty simple, don’t you think? Again, I focused on preprocessing, but you can run similar jobs for postprocessing and model evaluation. Don’t forget to check out the examples in
   <a href="https://github.com/awslabs/amazon-sagemaker-examples">
    Github
   </a>
   .
  </p>
  <p>
   <span style="text-decoration: underline;">
    <strong>
     Now Available!
    </strong>
   </span>
   <br/>
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker Processing
   </a>
   is available today in all commercial AWS Regions where
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker
   </a>
   is available.
  </p>
  <p>
   Give it a try and please send us feedback, either on the
   <a href="https://forums.aws.amazon.com/forum.jspa?forumID=285">
    AWS forum
   </a>
   for
   <a href="https://aws.amazon.com/sagemaker/">
    Amazon SageMaker
   </a>
   , or through your usual AWS support contacts.
  </p>
  <p>
   —
   <a href="https://aws.amazon.com/developer/community/evangelists/julien-simon/">
    Julien
   </a>
  </p>
  <!-- '"` -->
  <hr/>
  <h3>
   About the Author
  </h3>
  <p>
   <strong>
    Julien is the Artificial Intelligence &amp; Machine Learning Evangelist for EMEA
   </strong>
   . He focuses on helping developers and enterprises bring their ideas to life. In his spare time, he reads the works of JRR Tolkien again and again.
  </p>
  <p>
  </p>
  <p>
  </p>
  <p>
  </p>
  <!-- '"` -->
 
  
  </body>
 </html>